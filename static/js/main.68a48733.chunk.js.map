{"version":3,"sources":["layouts/FullscreenPageLayout.tsx","versioning.ts","selectors/index.ts","utils.ts","components/Navbar.tsx","components/Footer.tsx","components/ErrorBoundary.tsx","layouts/PanelLayout.tsx","actions/editor.ts","editor-tools/Tool.ts","properties/PropertyType.ts","editor-tools/Select.tsx","properties/validators.ts","models/svg.ts","selectors/palette.ts","components/SvgShapeRenderer.tsx","idGenerators.ts","editor-tools/index.tsx","editor-tools/Line.tsx","editor-tools/Polyline.tsx","editor-tools/Circle.tsx","editor-tools/Polygon.tsx","selectors/editor.ts","actions/tiles.ts","components/SvgToolbar.tsx","components/Scrollable.tsx","components/controls/helpers.ts","components/controls/IntegerControl.tsx","components/controls/FloatControl.tsx","components/controls/PointControl.tsx","actions/palette.ts","actions/index.ts","reducers/palette.ts","components/controls/PalettePickerControl.tsx","components/controls/Field.tsx","components/PropertyEditor.tsx","components/SvgPropertyEditor.tsx","components/SvgCanvas.tsx","components/SvgGrid.tsx","selectors/tiles.ts","components/SvgEditorCanvas.tsx","components/SvgElementViewer.tsx","components/SvgEditor.tsx","pages/TileEditor/index.tsx","actions/generator.ts","selectors/generator.ts","components/controls/SelectControl.tsx","generators/Selector.ts","properties/decorators.ts","generators/selectors.ts","generators/index.ts","components/TileSvg.tsx","components/MosaicRenderer.tsx","components/GenerateMosaic.tsx","reducers/editor.ts","reducers/tiles.ts","reducers/generator.ts","reducers/index.ts","pages/Generator/GeneratorSettings.tsx","components/ReorderableTileList.tsx","pages/Generator/TilesSidebar.tsx","pages/Generator/index.tsx","pages/Tiles/TileItem.tsx","pages/Tiles/index.tsx","pages/Tiles/Reorder.tsx","import.ts","pages/Import/index.tsx","pages/Help/index.tsx","App.tsx","reportWebVitals.ts","index.tsx","exampleProject.ts"],"names":["FullscreenPageLayout","props","className","header","children","footer","VERSION","MAJOR","MINOR","exportSelector","state","version","tiles","generator","palette","reorder","list","startIndex","endIndex","result","Array","from","splice","removed","download","filename","text","element","document","createElement","setAttribute","encodeURIComponent","style","display","body","appendChild","click","removeChild","Navbar","exportData","useSelector","handleExport","useCallback","e","preventDefault","stopPropagation","Date","toISOString","JSON","stringify","role","aria-label","to","exact","activeClassName","href","onClick","Footer","blk","bem","ErrorBoundary","hasError","error","errorInfo","console","this","React","Component","PanelLayout","horizontal","vertical","left","right","EDITOR_ADD_SHAPE","EDITOR_SET_GRID","EDITOR_SELECT_SHAPE","EDITOR_SELECT_TOOL","EDITOR_ELEM_PROP_CHANGE","EDITOR_SET_ELEMENTS","EDITOR_DELETE_ELEMENT","EDITOR_CLEAR","addShape","shape","type","selectShape","idx","selectTool","tool","setElements","elements","ToolType","PropertyType","Tool","dispatch","CREATOR","Select","MANIPULATOR","SvgShapeType","MinValidator","min","value","undefined","WithStrokeProperties","strokeWidth","label","FLOAT","validators","strokeColorId","COLOR","WithFillProperties","fillColorId","SvgCircleProperties","center","POINT","required","r","SvgLineProperties","point1","point2","SvgPolygonProperties","SvgPolylineProperties","propertiesMap","TYPE_LINE","TYPE_POLYGON","TYPE_POLYLINE","TYPE_CIRCLE","colorSelector","id","paletteSelector","selectedColor","SvgLineRenderer","line","selected","color","actualColor","x1","x","y1","y","x2","y2","stroke","eventHandlers","SvgPolylineRenderer","polyline","points","map","p","join","fill","SvgCircleRenderer","circle","strokeColor","cx","cy","SvgPolygonRenderer","polygon","SvgShapeRenderer","idGeneratorFactory","lastId","setLastId","getNextId","Tools","ShapeIdGenerator","PaletteIdGenerator","TileIdGenerator","Line","getInitialState","zIndex","Polyline","concat","pop","push","Circle","getDistance","p1","p2","dx","dy","Math","sqrt","Polygon","length","onFinish","toolMap","SELECT","LINE","POLYLINE","CIRCLE","POLYGON","gridSizeSelector","editor","gridSize","elementsSelector","toolSelector","selectedTool","selectedIdxSelector","selectedIdx","TILES_SET_TILE","TILES_DELETE_TILE","TILES_SET_TILES","TILES_DUPLICATE_TILE","TILES_ROTATE","rotate","ccw","SvgToolbar","useDispatch","history","useHistory","params","useParams","parseInt","handleSave","tile","Scrollable","useValue","useState","setValue","useEffect","useControlLogic","validator","formatter","setError","handleChange","val","onChange","args","success","formatted","IntegerControl","test","i","isNaN","target","FloatControl","parseFloat","step","PointControl","name","PALETTE_ADD_COLOR","PALETTE_REMOVE_COLOR","PALETTE_UPDATE_COLOR","IMPORT_PROJECT","defaultColor","initialState","0","NoColorSvg","viewBox","preserveAspectRatio","PickerItem","forwardRef","ref","canEdit","onDelete","onSelect","editOpen","setEditOpen","openEdit","closeEdit","handleEdit","updateColor","hex","backgroundColor","onChangeComplete","PalettePickerControl","ids","Object","keys","k","selectedRef","useRef","handleSelection","handleDelete","removeColor","handleAddColor","current","scrollIntoView","Field","Control","control","controlProps","err","propertyControlMap","INTEGER","PropertyInput","property","propName","PropertyEditor","properties","definitions","prop","valueAccessor","SvgPropertyEditor","key","elemIdx","elemPropChange","propAccessor","SvgCanvas","padding","svgRef","width","height","overlay","SvgGrid","gridLinesCount","grid","lines","_","strokeOpacity","vectorEffect","tilesSelector","isInBounds","SvgEditorCanvas","svg","setSvgRef","svgPoint","setSvgPoint","el","createSVGPoint","clientX","clientY","transformed","matrixTransform","getScreenCTM","inverse","round","useSvgUtils","eventToSvgCoords","hoverPoint","setHoverPoint","setSelectedTool","toolState","setToolState","onMouseMove","onMouseLeave","onShapeClick","svgEventHandlers","renderedShape","renderShape","showHoverPoint","toolType","useTool","find","t","tileSelector","handleClick","point","handleMouseMove","handleMouseExit","handleShapeClick","handleContextMenu","onContextMenu","shapeToLabel","SvgElementViewer","handleSelect","handleDragEnd","destination","source","index","deleteElement","handleDeselect","elementsReversed","reverse","onDragEnd","droppableId","provided","snapshot","droppableProps","innerRef","draggableId","toString","innerProvided","draggableProps","dragHandleProps","placeholder","SvgEditor","TileEditor","GENERATOR_SET_ROWS","GENERATOR_SET_COLS","GENERATOR_SET_SELECTOR","GENERATOR_SET_SELECTOR_PROPERTY","GENERATOR_SET_BACKGROUND","rowsSelector","rows","colsSelector","cols","tileSelectorKeySelector","tileSelectorPropertiesSelector","tileSelectorProperties","backgroundColorIdSelector","backgroundColorId","SelectControl","choices","choice","bindSelector","selector","selectTile","bind","Property","defineProperty","__propertyDefinitions","getPropertyDefinitions","obj","LinearSelector","description","defaultProperties","offset","generators","tileSelectors","GeometricSelector","q","initial","last","FibonacciSelector","n1","n2","tmp","getTileSelectorByName","TileSvg","xmlns","MosaicRenderer","tilesLen","rowArray","useMemo","colArray","tileMatrix","row","col","selectedTile","tileDefinitions","shapeRendering","xmlnsXlink","column","tileId","xlinkHref","GenerateMosaic","tileSelectorKey","rotatePoint","tx","ty","varObj","rootReducer","combineReducers","action","newSelected","size","s","newSelectedIdx","findIndex","newElements","filter","isIt","newState","parse","data","tileIdx","duplicated","newId","newTiles","store","createStore","composeWithDevTools","GeneratorSettings","handleRowsChange","setRows","handleColsChange","setCols","handleTileSelectorChange","selectorChoices","propertiesValueAccessor","handlePropertyChange","setSelectorProperty","ReactDOMServer","renderToStaticMarkup","ReorderableTileList","setTiles","TilesSidebar","handleBackgroundChange","setBackground","Generator","NewTileItem","TileItem","handleClone","handleRotateCCW","handleRotateCW","Tiles","handleAddNew","Reorder","importProjectAndSetupIdGenerators","importProject","maxPaletteId","reduce","max","maxTileId","maxShapeId","elMax","Import","file","setFile","handleFileChange","files","handleImport","reader","FileReader","onload","event","message","readAsText","Help","readme","setReadme","fetch","then","response","ok","Error","status","statusText","catch","App","path","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById","savedState","localStorage","getItem","window","onbeforeunload","getState","setItem"],"mappings":"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","file":"static/js/main.68a48733.chunk.js","sourcesContent":["import React, {ReactNode, ReactNodeArray} from \"react\";\r\n\r\ninterface Props {\r\n    header?: ReactNode | ReactNodeArray\r\n    children: ReactNode | ReactNodeArray\r\n    footer?: ReactNode | ReactNodeArray\r\n}\r\n\r\nconst FullscreenPageLayout = (props: Props) => {\r\n    return (\r\n        <div className=\"fullscreen-layout\">\r\n            <div className=\"fullscreen-layout__header\">\r\n                { props.header }\r\n            </div>\r\n            <div className=\"fullscreen-layout__content\">\r\n                { props.children }\r\n            </div>\r\n            <div className=\"fullscreen-layout__footer\">\r\n                { props.footer }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FullscreenPageLayout;\r\n","export interface Version {\r\n    MAJOR: number;\r\n    MINOR: number;\r\n}\r\n\r\nexport const VERSION: Version = {\r\n    MAJOR: 0,\r\n    MINOR: 1\r\n}\r\n","import {TheState} from \"../reducers\";\r\nimport {VERSION} from \"../versioning\";\r\nimport {ProjectType} from \"../actions\";\r\n\r\nexport const exportSelector = (state: TheState): ProjectType => ({\r\n    version: VERSION,\r\n    tiles: state.tiles,\r\n    generator: state.generator,\r\n    palette: state.palette,\r\n})\r\n","export function reorder<T>(list: T[], startIndex: number, endIndex: number): T[] {\r\n    const result = Array.from(list);\r\n    const [removed] = result.splice(startIndex, 1);\r\n    result.splice(endIndex, 0, removed);\r\n\r\n    return result;\r\n}\r\n\r\nexport const varToString = (varObj: {[key: string]: any}) => Object.keys(varObj)[0];\r\n\r\nexport function download(filename: string, text: string) {\r\n    const element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\r\n    element.setAttribute('download', filename);\r\n\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n\r\n    element.click();\r\n\r\n    document.body.removeChild(element);\r\n}\r\n","import React, {useCallback} from \"react\";\r\nimport {NavLink} from \"react-router-dom\";\r\nimport {useSelector} from \"react-redux\";\r\nimport {exportSelector} from \"../selectors\";\r\nimport {download} from \"../utils\";\r\n\r\nconst Navbar = () => {\r\n    const exportData = useSelector(exportSelector);\r\n\r\n    const handleExport = useCallback((e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        download(\"TMG-\" + new Date().toISOString() + \".json\", JSON.stringify(exportData));\r\n    }, [exportData]);\r\n\r\n    return (\r\n        <nav className=\"navbar is-info\" role=\"navigation\" aria-label=\"main navigation\">\r\n            <div className=\"navbar-brand\">\r\n                <h1 className=\"navbar-item is-flex-direction-column\">\r\n                    <span className=\"title is-4 mb-4 has-text-white\">Tile Mosaic</span>\r\n                    <span className=\"subtitle is-6 is-uppercase is-bold has-text-light\">Generator</span>\r\n                </h1>\r\n            </div>\r\n\r\n            <div className=\"navbar-menu\">\r\n                <div className=\"navbar-start\">\r\n                    <NavLink to=\"/\" exact className=\"navbar-item\" activeClassName=\"is-active\">\r\n                        Generator\r\n                    </NavLink>\r\n\r\n                    <NavLink to=\"/tiles\" className=\"navbar-item\" activeClassName=\"is-active\">\r\n                        Tiles\r\n                    </NavLink>\r\n                </div>\r\n                <div className=\"navbar-end\">\r\n\r\n                    <a href=\"#\" onClick={handleExport} className=\"navbar-item ml-3\">\r\n                        <span className=\"icon mr-1\">\r\n                            <i className=\"fas fa-file-export\" />\r\n                        </span>\r\n                        Export project\r\n                    </a>\r\n                    <NavLink to=\"/import\" className=\"navbar-item\" activeClassName=\"is-active\">\r\n                        <span className=\"icon mr-1\">\r\n                            <i className=\"fas fa-file-import\" />\r\n                        </span>\r\n                        Import project\r\n                    </NavLink>\r\n                    <NavLink to=\"/help\" className=\"navbar-item\" activeClassName=\"is-active\">\r\n                        <span className=\"icon mr-1\">\r\n                            <i className=\"fas fa-question-circle\" />\r\n                        </span>\r\n                        Help\r\n                    </NavLink>\r\n                </div>\r\n            </div>\r\n        </nav>\r\n    );\r\n}\r\n\r\nexport default Navbar;\r\n","import React from \"react\";\r\nimport {VERSION} from \"../versioning\";\r\n\r\nconst Footer = () => {\r\n    return (\r\n        <footer className=\"has-background-light p-3\">\r\n            <div className=\"content has-text-centered\">\r\n                <p className=\"has-text-grey is-size-7\">\r\n                    <i>Tile Mosaic Generator</i> is created by Martin Omacht as a project for VIN course\r\n                    at Brno University of Technology in 2021. (Version: {VERSION.MAJOR}.{VERSION.MINOR})\r\n                </p>\r\n            </div>\r\n        </footer>\r\n    );\r\n}\r\n\r\nexport default Footer;\r\n","import React, {ReactNode} from \"react\";\r\nimport bem from \"bem-ts\";\r\n\r\ninterface Props {\r\n    children: ReactNode;\r\n}\r\n\r\ninterface State {\r\n    hasError: boolean;\r\n}\r\n\r\nconst blk = bem('error-boundary');\r\n\r\nexport default class ErrorBoundary extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            hasError: false\r\n        }\r\n    }\r\n\r\n    static getDerivedStateFromError(): State {\r\n        return { hasError: true };\r\n    }\r\n\r\n    componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n        console.error(error, errorInfo);\r\n    }\r\n\r\n    render() {\r\n        if (this.state.hasError) {\r\n            return (\r\n                <div className={blk()}>\r\n                    <div className={blk('content')}>\r\n                        <h2 className=\"title is-3 has-text-danger\">Error occurred</h2>\r\n                        <p>Error occurred during render of this component.</p>\r\n                    </div>\r\n                </div>\r\n            )\r\n        }\r\n\r\n        return this.props.children ?? null;\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport ErrorBoundary from \"../components/ErrorBoundary\";\r\n\r\ninterface Props {\r\n    horizontal?: boolean;\r\n    left?: React.ReactNodeArray | React.ReactNode;\r\n    children: React.ReactNodeArray | React.ReactNode;\r\n    right?: React.ReactNodeArray | React.ReactNode;\r\n}\r\n\r\nconst blk = bem('panel-layout');\r\n\r\nconst PanelLayout = (props: Props) => {\r\n    const horizontal = props.horizontal;\r\n    return (\r\n        <div className={blk({horizontal, vertical: !horizontal})}>\r\n            <div className={blk('side')}>\r\n                <ErrorBoundary>\r\n                    { props.left }\r\n                </ErrorBoundary>\r\n            </div>\r\n            <div className={blk('content')}>\r\n                <ErrorBoundary>\r\n                    { props.children }\r\n                </ErrorBoundary>\r\n            </div>\r\n            <div className={blk('side')}>\r\n                <ErrorBoundary>\r\n                    { props.right }\r\n                </ErrorBoundary>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default PanelLayout;\r\n","import {SvgShape} from \"../models/svg\";\r\nimport {Action} from \"redux\";\r\nimport {Tools} from \"../editor-tools\";\r\n\r\nexport const EDITOR_ADD_SHAPE = 'EDITOR_ADD_SHAPE';\r\nexport const EDITOR_SET_GRID = 'EDITOR_SET_GRID';\r\nexport const EDITOR_SELECT_SHAPE = 'EDITOR_SELECT_SHAPE';\r\nexport const EDITOR_SELECT_TOOL = 'EDITOR_SELECT_TOOL';\r\nexport const EDITOR_ELEM_PROP_CHANGE = 'EDITOR_ELEM_PROP_CHANGE';\r\nexport const EDITOR_SET_ELEMENTS = 'EDITOR_SET_ELEMENTS';\r\nexport const EDITOR_DELETE_ELEMENT = 'EDITOR_DELETE_ELEMENT';\r\nexport const EDITOR_CLEAR = 'EDITOR_CLEAR';\r\n\r\nexport interface AddShapeAction extends Action<typeof EDITOR_ADD_SHAPE> {\r\n    shape: SvgShape\r\n}\r\n\r\nexport function addShape(shape: SvgShape): AddShapeAction {\r\n    return {\r\n        type: EDITOR_ADD_SHAPE,\r\n        shape\r\n    }\r\n}\r\n\r\nexport interface SetGridAction extends Action<typeof EDITOR_SET_GRID> {\r\n    size: number;\r\n}\r\n\r\nexport function setGrid(size: number): SetGridAction {\r\n    return {\r\n        type: EDITOR_SET_GRID,\r\n        size\r\n    }\r\n}\r\n\r\nexport interface SelectShapeAction extends Action<typeof EDITOR_SELECT_SHAPE> {\r\n    idx: number | null;\r\n}\r\n\r\nexport function selectShape(idx: number | null): SelectShapeAction {\r\n    return {\r\n        type: EDITOR_SELECT_SHAPE,\r\n        idx\r\n    }\r\n}\r\n\r\nexport interface SelectToolAction extends Action<typeof EDITOR_SELECT_TOOL> {\r\n    tool: Tools\r\n}\r\n\r\nexport function selectTool(tool: Tools): SelectToolAction {\r\n    return {\r\n        type: EDITOR_SELECT_TOOL,\r\n        tool\r\n    }\r\n}\r\n\r\nexport interface ElemPropChangeAction extends Action<typeof EDITOR_ELEM_PROP_CHANGE> {\r\n    elemIdx: number;\r\n    propName: string;\r\n    value: any;\r\n}\r\n\r\nexport function elemPropChange(elemIdx: number, propName: string, value: any) {\r\n    return {\r\n        type: EDITOR_ELEM_PROP_CHANGE,\r\n        elemIdx,\r\n        propName,\r\n        value\r\n    }\r\n}\r\n\r\nexport interface SetElementsAction extends Action<typeof EDITOR_SET_ELEMENTS> {\r\n    elements: SvgShape[]\r\n}\r\n\r\nexport function setElements(elements: SvgShape[]): SetElementsAction {\r\n    return {\r\n        type: EDITOR_SET_ELEMENTS,\r\n        elements\r\n    }\r\n}\r\n\r\nexport interface DeleteElementAction extends Action<typeof EDITOR_DELETE_ELEMENT> {\r\n    id: number\r\n}\r\n\r\nexport function deleteElement(id: number): DeleteElementAction {\r\n    return {\r\n        type: EDITOR_DELETE_ELEMENT,\r\n        id\r\n    }\r\n}\r\n\r\nexport interface ClearAction extends Action<typeof EDITOR_CLEAR> {\r\n\r\n}\r\n\r\n\r\nexport function clear(): ClearAction {\r\n    return {\r\n        type: EDITOR_CLEAR\r\n    }\r\n}\r\n\r\nexport type EditorActions =\r\n    AddShapeAction |\r\n    SetGridAction |\r\n    SelectShapeAction |\r\n    SelectToolAction |\r\n    ElemPropChangeAction |\r\n    SetElementsAction |\r\n    DeleteElementAction |\r\n    ClearAction;\r\n","import {ReactNode} from \"react\";\r\nimport {Dispatch} from \"redux\";\r\nimport {Point, SvgShape} from \"../models/svg\";\r\n\r\nexport enum ToolType {\r\n    CREATOR,\r\n    MANIPULATOR,\r\n}\r\n\r\nexport default abstract class Tool<T> {\r\n    public onClick(state: T, dispatch: Dispatch, e: Point): T {\r\n        return state;\r\n    }\r\n\r\n    public onMouseMove(state: T, dispatch: Dispatch, e: Point): T {\r\n        return state;\r\n    }\r\n\r\n    public onMouseLeave(state: T, dispatch: Dispatch, e: Point) {\r\n        return state;\r\n    }\r\n\r\n    public onShapeClick(state: T, dispatch: Dispatch, idx: number, shape: SvgShape): T {\r\n        return state;\r\n    }\r\n\r\n    public onFinish(state: T, dispatch: Dispatch): T {\r\n        return state;\r\n    }\r\n\r\n    public renderShape(state: T): ReactNode {\r\n        return null;\r\n    }\r\n\r\n    public toolType(): ToolType {\r\n        return ToolType.CREATOR;\r\n    }\r\n\r\n    public showHoverPoint(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public abstract getInitialState(): T;\r\n}\r\n\r\n","export enum PropertyType {\r\n    INTEGER,\r\n    FLOAT,\r\n    POINT,\r\n    COLOR,\r\n}\r\n","import Tool, {ToolType} from \"./Tool\";\r\nimport {Dispatch} from \"redux\";\r\nimport {Point, SvgShape} from \"../models/svg\";\r\nimport {selectShape} from \"../actions/editor\";\r\n\r\nexport interface SelectState {\r\n\r\n}\r\n\r\nexport default class Select extends Tool<SelectState> {\r\n    onClick(state: SelectState, dispatch: Dispatch, e: Point): SelectState {\r\n        dispatch(selectShape(null));\r\n        return state;\r\n    }\r\n\r\n    onShapeClick(state: SelectState, dispatch: Dispatch, idx: number, shape: SvgShape): SelectState {\r\n        dispatch(selectShape(idx));\r\n        return state;\r\n    }\r\n\r\n    showHoverPoint(): boolean {\r\n        return false;\r\n    }\r\n\r\n    toolType(): ToolType {\r\n        return ToolType.MANIPULATOR;\r\n    }\r\n\r\n    getInitialState(): SelectState {\r\n        return {};\r\n    }\r\n}\r\n","import {Validator} from \"./Validator\";\r\n\r\nexport const MinValidator: (min: number) => Validator<number | null> =\r\n        min => value => (value && value < min ? `Minimum is ${min}` : undefined);\r\nexport const MaxValidator: (max: number) => Validator<number | null> =\r\n        max => value => (value && value > max ? `Maximum is ${max}` : undefined);\r\n\r\n","import {PropertyDefinitions} from \"../properties/PropertyDefinition\";\r\nimport {PropertyType} from \"../properties/PropertyType\";\r\nimport {MinValidator} from \"../properties/validators\";\r\n\r\nexport enum SvgShapeType {\r\n    TYPE_CIRCLE = 'CIRCLE',\r\n    TYPE_LINE = 'LINE',\r\n    TYPE_POLYGON = 'POLYGON',\r\n    TYPE_POLYLINE = 'POLYLINE',\r\n}\r\n\r\nexport interface Point {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport interface SvgShape {\r\n    type: SvgShapeType;\r\n    id: number;\r\n    [key: string]: any;\r\n}\r\n\r\ninterface WithStroke {\r\n    strokeWidth: number | null;\r\n    strokeColorId: number | null;\r\n}\r\n\r\nconst WithStrokeProperties: PropertyDefinitions = {\r\n    strokeWidth: {\r\n        label: 'Stroke width',\r\n        type: PropertyType.FLOAT,\r\n        validators: [MinValidator(0)] as any\r\n    },\r\n    strokeColorId: {\r\n        label: 'Stroke color',\r\n        type: PropertyType.COLOR\r\n    }\r\n}\r\n\r\ninterface WithFill {\r\n    fillColorId: number | null;\r\n}\r\n\r\nconst WithFillProperties: PropertyDefinitions = {\r\n    fillColorId: {\r\n        label: 'Fill color',\r\n        type: PropertyType.COLOR\r\n    }\r\n}\r\n\r\nexport interface SvgCircle extends SvgShape, WithStroke, WithFill {\r\n    center: Point;\r\n    r: number;\r\n}\r\n\r\nexport const SvgCircleProperties: PropertyDefinitions = {\r\n    center: {\r\n        label: 'Center',\r\n        type: PropertyType.POINT,\r\n        required: true\r\n    },\r\n    r: {\r\n        label: 'Radius',\r\n        type: PropertyType.FLOAT,\r\n        required: true\r\n    },\r\n    ...WithFillProperties,\r\n    ...WithStrokeProperties\r\n}\r\n\r\nexport interface SvgLine extends SvgShape, WithStroke {\r\n    point1: Point;\r\n    point2: Point;\r\n}\r\n\r\nexport const SvgLineProperties: PropertyDefinitions = {\r\n    point1: {\r\n        label: 'Start point',\r\n        type: PropertyType.POINT,\r\n        required: true\r\n    },\r\n    point2: {\r\n        label: 'End point',\r\n        type: PropertyType.POINT,\r\n        required: true\r\n    },\r\n    ...WithStrokeProperties\r\n}\r\n\r\nexport interface SvgPolygon extends SvgShape, WithStroke, WithFill {\r\n    points: Point[];\r\n}\r\n\r\nexport const SvgPolygonProperties: PropertyDefinitions = {\r\n    ...WithStrokeProperties,\r\n    ...WithFillProperties\r\n}\r\n\r\nexport interface SvgPolyline extends SvgShape, WithStroke {\r\n    points: Point[];\r\n}\r\n\r\nexport const SvgPolylineProperties: PropertyDefinitions = WithStrokeProperties;\r\n\r\nexport const propertiesMap = {\r\n    [SvgShapeType.TYPE_LINE]: SvgLineProperties,\r\n    [SvgShapeType.TYPE_POLYGON]: SvgPolygonProperties,\r\n    [SvgShapeType.TYPE_POLYLINE]: SvgPolylineProperties,\r\n    [SvgShapeType.TYPE_CIRCLE]: SvgCircleProperties,\r\n}\r\n","import {TheState} from \"../reducers\";\r\nimport {PaletteState} from \"../reducers/palette\";\r\n\r\nexport const colorSelector = (id: number | null) => (state: TheState) => id === null ? undefined : state.palette[id];\r\nexport const paletteSelector = (state: TheState): PaletteState => state.palette;\r\n","import React from \"react\";\r\nimport {SvgCircle, SvgLine, SvgPolygon, SvgPolyline, SvgShape, SvgShapeType} from \"../models/svg\";\r\nimport {useSelector} from \"react-redux\";\r\nimport {colorSelector} from \"../selectors/palette\";\r\n\r\ninterface RendererProps {\r\n    eventHandlers?: any;\r\n    selected?: boolean;\r\n}\r\n\r\nconst selectedColor = '#3298dc';\r\n\r\nconst SvgLineRenderer = (props: {line: SvgLine} & RendererProps) => {\r\n    const {line, selected} = props;\r\n\r\n    const color = useSelector(colorSelector(line.strokeColorId));\r\n    const actualColor = selected ? selectedColor : color;\r\n    return <line\r\n        x1={line.point1.x}\r\n        y1={line.point1.y}\r\n        x2={line.point2.x}\r\n        y2={line.point2.y}\r\n        stroke={actualColor ?? 'none'}\r\n        strokeWidth={line.strokeWidth ?? 0}\r\n        {...props.eventHandlers} />;\r\n}\r\n\r\nconst SvgPolylineRenderer = (props: {polyline: SvgPolyline} & RendererProps) => {\r\n    const {polyline, selected} = props;\r\n\r\n    const color = useSelector(colorSelector(polyline.strokeColorId));\r\n    const actualColor = selected ? selectedColor : color;\r\n    return <polyline\r\n        points={polyline.points.map(p => `${p.x},${p.y}`).join(' ')}\r\n        stroke={actualColor ?? 'none'}\r\n        strokeWidth={polyline.strokeWidth ?? 0}\r\n        fill=\"none\"\r\n        {...props.eventHandlers} />\r\n}\r\n\r\nconst SvgCircleRenderer = (props: {circle: SvgCircle} & RendererProps) => {\r\n    const {circle, selected} = props;\r\n\r\n    const color = useSelector(colorSelector(circle.fillColorId));\r\n    const actualColor = selected ? selectedColor : color;\r\n\r\n    const strokeColor = useSelector(colorSelector(circle.strokeColorId));\r\n\r\n    return <circle\r\n        cx={circle.center.x}\r\n        cy={circle.center.y}\r\n        r={circle.r}\r\n        fill={actualColor ?? 'none'}\r\n        stroke={strokeColor ?? 'none'}\r\n        strokeWidth={circle.strokeWidth ?? 0}\r\n        {...props.eventHandlers} />\r\n}\r\n\r\nconst SvgPolygonRenderer = (props: {polygon: SvgPolygon} & RendererProps) => {\r\n    const {polygon, selected} = props;\r\n\r\n    const color = useSelector(colorSelector(polygon.fillColorId));\r\n    const actualColor = selected ? selectedColor : color;\r\n\r\n    const strokeColor = useSelector(colorSelector(polygon.strokeColorId));\r\n\r\n    return <polygon\r\n        points={polygon.points.map(p => `${p.x},${p.y}`).join(' ')}\r\n        fill={actualColor ?? 'none'}\r\n        stroke={strokeColor ?? 'none'}\r\n        strokeWidth={polygon.strokeWidth ?? 0}\r\n        {...props.eventHandlers} />\r\n}\r\n\r\nconst SvgShapeRenderer = (props: {shape: SvgShape} & RendererProps) => {\r\n    const shape = props.shape;\r\n\r\n    switch (shape.type) {\r\n        case SvgShapeType.TYPE_LINE:\r\n            return <SvgLineRenderer line={shape as SvgLine} eventHandlers={props.eventHandlers} selected={props.selected} />\r\n        case SvgShapeType.TYPE_POLYLINE:\r\n            return <SvgPolylineRenderer polyline={shape as SvgPolyline} eventHandlers={props.eventHandlers} selected={props.selected} />\r\n        case SvgShapeType.TYPE_CIRCLE:\r\n            return <SvgCircleRenderer circle={shape as SvgCircle} eventHandlers={props.eventHandlers} selected={props.selected} />\r\n        case SvgShapeType.TYPE_POLYGON:\r\n            return <SvgPolygonRenderer polygon={shape as SvgPolygon} eventHandlers={props.eventHandlers} selected={props.selected} />\r\n        default:\r\n            return null;\r\n    }\r\n}\r\n\r\nexport default SvgShapeRenderer;\r\n","\r\nexport interface IdGenerator {\r\n    setLastId: (id: number) => void;\r\n    getNextId: () => number;\r\n}\r\n\r\nfunction idGeneratorFactory(): IdGenerator {\r\n    let lastId = 0;\r\n    return {\r\n        setLastId: (id: number) => lastId = id,\r\n        getNextId: () => ++lastId\r\n    };\r\n}\r\n\r\nexport const ShapeIdGenerator: IdGenerator = idGeneratorFactory();\r\n\r\nexport const PaletteIdGenerator: IdGenerator = idGeneratorFactory();\r\n\r\nexport const TileIdGenerator: IdGenerator = idGeneratorFactory();\r\n","import {ReactNode, useCallback, useEffect, useState} from \"react\";\r\nimport {useDispatch} from \"react-redux\";\r\nimport Select from \"./Select\";\r\nimport Line from \"./Line\";\r\nimport Polyline from \"./Polyline\";\r\nimport Circle from \"./Circle\";\r\nimport Polygon from \"./Polygon\";\r\nimport {Point, SvgShape} from \"../models/svg\";\r\nimport Tool, {ToolType} from \"./Tool\";\r\n\r\nexport enum Tools {\r\n    SELECT,\r\n    LINE,\r\n    POLYLINE,\r\n    CIRCLE,\r\n    POLYGON,\r\n}\r\n\r\nconst toolMap = {\r\n    [Tools.SELECT]: new Select(),\r\n    [Tools.LINE]: new Line(),\r\n    [Tools.POLYLINE]: new Polyline(),\r\n    [Tools.CIRCLE]: new Circle(),\r\n    [Tools.POLYGON]: new Polygon(),\r\n}\r\n\r\ntype EditorEventHandler = (p: Point) => void;\r\n\r\ninterface ToolHook {\r\n    svgEventHandlers: {\r\n        onClick: EditorEventHandler,\r\n        onMouseMove: EditorEventHandler,\r\n        onMouseLeave: EditorEventHandler,\r\n        onFinish: () => void;\r\n    };\r\n    onShapeClick: (idx: number, shape: SvgShape) => void;\r\n    renderedShape: ReactNode;\r\n    showHoverPoint: boolean;\r\n    toolType: ToolType;\r\n}\r\n\r\nexport const useTool = (tool: Tools): ToolHook => {\r\n    const dispatch = useDispatch();\r\n    const [selectedTool, setSelectedTool] = useState<Tool<any>>(toolMap[tool]);\r\n    const [toolState, setToolState] = useState<any>(selectedTool.getInitialState());\r\n\r\n    useEffect(() => {\r\n        setSelectedTool(toolMap[tool]);\r\n        setToolState(toolMap[tool].getInitialState());\r\n    }, [tool]);\r\n\r\n    const onClick = useCallback((e: Point) => {\r\n        setToolState(selectedTool.onClick(toolState, dispatch, e));\r\n    }, [toolState, dispatch, setToolState, selectedTool]);\r\n\r\n    const onMouseMove = useCallback((e: Point) => {\r\n        setToolState(selectedTool.onMouseMove(toolState, dispatch, e));\r\n    }, [toolState, dispatch, setToolState, selectedTool]);\r\n\r\n    const onMouseLeave = useCallback((e: Point) => {\r\n        setToolState(selectedTool.onMouseLeave(toolState, dispatch, e));\r\n    }, [toolState, dispatch, setToolState, selectedTool]);\r\n\r\n    const onShapeClick = useCallback((idx, shape) => {\r\n        setToolState(selectedTool.onShapeClick(toolState, dispatch, idx, shape));\r\n    }, [toolState, dispatch, setToolState, selectedTool]);\r\n\r\n    const onFinish = useCallback(() => {\r\n        setToolState(selectedTool.onFinish(toolState, dispatch));\r\n    }, [toolState, dispatch, setToolState, selectedTool]);\r\n\r\n    return {\r\n        svgEventHandlers: {\r\n            onClick,\r\n            onMouseMove,\r\n            onMouseLeave,\r\n            onFinish,\r\n        },\r\n        onShapeClick,\r\n        renderedShape: selectedTool.renderShape(toolState),\r\n        showHoverPoint: selectedTool.showHoverPoint(),\r\n        toolType: selectedTool.toolType(),\r\n    }\r\n}\r\n","import Tool from \"./Tool\";\r\nimport {Point, SvgLine, SvgShapeType} from \"../models/svg\";\r\nimport {Dispatch} from \"redux\";\r\nimport React from \"react\";\r\nimport {addShape} from \"../actions/editor\";\r\nimport SvgShapeRenderer from \"../components/SvgShapeRenderer\";\r\nimport {ShapeIdGenerator} from \"../idGenerators\";\r\n\r\nexport type LineState = Partial<SvgLine>;\r\n\r\nexport default class Line extends Tool<LineState> {\r\n    onClick(state: LineState, dispatch: Dispatch, e: Point): LineState {\r\n        if (state.point1) {\r\n            dispatch(addShape({...state, id: ShapeIdGenerator.getNextId()} as SvgLine));\r\n            return this.getInitialState();\r\n        }\r\n        return {...state, point1: e};\r\n    }\r\n\r\n    onMouseMove(state: LineState, dispatch: Dispatch, e: Point): LineState {\r\n        if (state.point1)\r\n            return {...state, point2: e};\r\n        return state;\r\n    }\r\n\r\n    renderShape(state: LineState): React.ReactNode {\r\n        if (state.point1 && state.point2) {\r\n            return <SvgShapeRenderer shape={state as SvgLine} />\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getInitialState(): LineState {\r\n        return {\r\n            type: SvgShapeType.TYPE_LINE,\r\n            zIndex: 0,\r\n            strokeColorId: 0,\r\n            strokeWidth: 2,\r\n        };\r\n    }\r\n}\r\n","import Tool from \"./Tool\";\r\nimport {Point, SvgPolyline, SvgShapeType} from \"../models/svg\";\r\nimport {Dispatch} from \"redux\";\r\nimport React from \"react\";\r\nimport SvgShapeRenderer from \"../components/SvgShapeRenderer\";\r\nimport {addShape} from \"../actions/editor\";\r\nimport {ShapeIdGenerator} from \"../idGenerators\";\r\n\r\nexport type PolylineState = SvgPolyline;\r\n\r\nexport default class Polyline extends Tool<PolylineState> {\r\n\r\n    onClick(state: PolylineState, dispatch: Dispatch, e: Point): PolylineState {\r\n        return {...state, points: state.points.concat(e)};\r\n    }\r\n\r\n    onMouseMove(state: PolylineState, dispatch: Dispatch, e: Point): PolylineState {\r\n        const points = [...state.points];\r\n        points.pop();\r\n        points.push(e);\r\n        return {...state, points};\r\n    }\r\n\r\n    onFinish(state: PolylineState, dispatch: Dispatch): PolylineState {\r\n        const points = [...state.points];\r\n        points.pop();\r\n        const shape = {...state, points, id: ShapeIdGenerator.getNextId()} as SvgPolyline;\r\n        dispatch(addShape(shape));\r\n\r\n        return this.getInitialState();\r\n    }\r\n\r\n    renderShape(state: PolylineState): React.ReactNode {\r\n        return <SvgShapeRenderer shape={state as SvgPolyline} />\r\n    }\r\n\r\n    getInitialState(): PolylineState {\r\n        return {\r\n            type: SvgShapeType.TYPE_POLYLINE,\r\n            zIndex: 0,\r\n            strokeColorId: 0,\r\n            strokeWidth: 2,\r\n            points: [],\r\n            id: 0,\r\n        };\r\n    }\r\n}\r\n","import Tool from \"./Tool\";\r\nimport {Point, SvgCircle, SvgShapeType} from \"../models/svg\";\r\nimport {Dispatch} from \"redux\";\r\nimport {addShape} from \"../actions/editor\";\r\nimport SvgShapeRenderer from \"../components/SvgShapeRenderer\";\r\nimport React from \"react\";\r\nimport {ShapeIdGenerator} from \"../idGenerators\";\r\n\r\nexport type CircleState = Partial<SvgCircle>;\r\n\r\nexport default class Circle extends Tool<CircleState> {\r\n    onClick(state: CircleState, dispatch: Dispatch, e: Point): CircleState {\r\n        if (state.center) {\r\n            dispatch(addShape({...state, id: ShapeIdGenerator.getNextId()} as SvgCircle));\r\n            return this.getInitialState();\r\n        }\r\n\r\n        return {...state, center: e};\r\n    }\r\n\r\n    onMouseMove(state: CircleState, dispatch: Dispatch, e: Point): CircleState {\r\n        if (state.center) {\r\n            return {...state, r: Circle.getDistance(state.center, e)};\r\n        }\r\n        return state;\r\n    }\r\n\r\n    renderShape(state: CircleState): React.ReactNode {\r\n        if (state.center && state.r)\r\n            return <SvgShapeRenderer shape={state as SvgCircle} />;\r\n        return null;\r\n    }\r\n\r\n    getInitialState(): CircleState {\r\n        return {\r\n            type: SvgShapeType.TYPE_CIRCLE,\r\n            zIndex: 0,\r\n            fillColorId: 0,\r\n            strokeWidth: null,\r\n            strokeColorId: null,\r\n        };\r\n    }\r\n\r\n    private static getDistance(p1: Point, p2: Point) {\r\n        const dx = p2.x - p1.x;\r\n        const dy = p2.y - p1.y;\r\n        return Math.sqrt(dx*dx + dy*dy);\r\n    }\r\n}\r\n","import Tool from \"./Tool\";\r\nimport {Point, SvgPolygon, SvgShapeType} from \"../models/svg\";\r\nimport {Dispatch} from \"redux\";\r\nimport {addShape} from \"../actions/editor\";\r\nimport React from \"react\";\r\nimport SvgShapeRenderer from \"../components/SvgShapeRenderer\";\r\nimport {ShapeIdGenerator} from \"../idGenerators\";\r\n\r\nexport type PolygonState = SvgPolygon;\r\n\r\nexport default class Polygon extends Tool<PolygonState> {\r\n    onClick(state: PolygonState, dispatch: Dispatch, e: Point): PolygonState {\r\n        if (state.points.length > 0 && e.x === state.points[0].x && e.y === state.points[0].y)\r\n            return this.onFinish(state, dispatch);\r\n        return {...state, points: state.points.concat([e, e])};\r\n    }\r\n\r\n    onMouseMove(state: PolygonState, dispatch: Dispatch, e: Point): PolygonState {\r\n        if (state.points.length === 0)\r\n            return state;\r\n\r\n        const points = [...state.points];\r\n        points.pop();\r\n        points.push(e);\r\n        return {...state, points};\r\n    }\r\n\r\n    onFinish(state: PolygonState, dispatch: Dispatch): PolygonState {\r\n        const points = [...state.points];\r\n        points.pop();\r\n        const shape = {...state, points, id: ShapeIdGenerator.getNextId()} as SvgPolygon;\r\n        dispatch(addShape(shape));\r\n\r\n        return this.getInitialState();\r\n    }\r\n\r\n    renderShape(state: PolygonState): React.ReactNode {\r\n        return <SvgShapeRenderer shape={state as SvgPolygon} />\r\n    }\r\n    getInitialState(): PolygonState {\r\n        return {\r\n            type: SvgShapeType.TYPE_POLYGON,\r\n            zIndex: 0,\r\n            fillColorId: 0,\r\n            points: [],\r\n            strokeColorId: null,\r\n            strokeWidth: null,\r\n            id: 0\r\n        };\r\n    }\r\n}\r\n","import {TheState} from \"../reducers\";\r\nimport {SvgShape} from \"../models/svg\";\r\nimport {Tools} from \"../editor-tools\";\r\n\r\nexport const gridSizeSelector = (state: TheState): number => state.editor.gridSize;\r\nexport const elementsSelector = (state: TheState): SvgShape[] => state.editor.elements;\r\nexport const toolSelector = (state: TheState): Tools => state.editor.selectedTool;\r\nexport const selectedIdxSelector = (state: TheState): number | null => state.editor.selectedIdx;\r\nexport const shapeSelector = (idx: number) => (state: TheState): SvgShape => state.editor.elements[idx];\r\nexport const elementPropertySelector = (idx: number, prop: string) => (state: TheState): any => state.editor.elements[idx][prop];\r\n","import {Action} from \"redux\";\r\nimport Tile from \"../models/Tile\";\r\n\r\nexport const TILES_SET_TILE = 'TILES_SET_TILE';\r\nexport const TILES_DELETE_TILE = 'TILES_DELETE_TILE';\r\nexport const TILES_SET_TILES = 'TILES_SET_TILES';\r\nexport const TILES_DUPLICATE_TILE = 'TILES_DUPLICATE_TILE';\r\nexport const TILES_ROTATE = 'TILES_ROTATE';\r\n\r\nexport interface SetTileAction extends Action<typeof TILES_SET_TILE> {\r\n    tile: Tile\r\n}\r\n\r\nexport function setTile(tile: Tile): SetTileAction {\r\n    return {\r\n        type: TILES_SET_TILE,\r\n        tile\r\n    }\r\n}\r\n\r\nexport interface DeleteTileAction extends Action<typeof TILES_DELETE_TILE> {\r\n    id: number;\r\n}\r\n\r\nexport function deleteTile(id: number): DeleteTileAction {\r\n    return {\r\n        type: TILES_DELETE_TILE,\r\n        id\r\n    }\r\n}\r\n\r\nexport interface SetTilesAction extends Action<typeof TILES_SET_TILES> {\r\n    tiles: Tile[];\r\n}\r\n\r\nexport function setTiles(tiles: Tile[]): SetTilesAction {\r\n    return {\r\n        type: TILES_SET_TILES,\r\n        tiles\r\n    }\r\n}\r\n\r\nexport interface DuplicateTileAction extends Action<typeof TILES_DUPLICATE_TILE> {\r\n    idx: number;\r\n    newId: number;\r\n}\r\n\r\nexport function duplicateTile(idx: number, newId: number): DuplicateTileAction {\r\n    return {\r\n        type: TILES_DUPLICATE_TILE,\r\n        idx,\r\n        newId\r\n    }\r\n}\r\n\r\nexport interface RotateAction extends Action<typeof TILES_ROTATE> {\r\n    idx: number;\r\n    ccw: boolean;\r\n}\r\n\r\nexport function rotate(idx: number, ccw: boolean): RotateAction {\r\n    return {\r\n        type: TILES_ROTATE,\r\n        idx,\r\n        ccw\r\n    }\r\n}\r\n\r\nexport type TilesActions = SetTileAction | DeleteTileAction | SetTilesAction | DuplicateTileAction | RotateAction;\r\n","import React, {useCallback} from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {selectTool} from \"../actions/editor\";\r\nimport {Tools} from \"../editor-tools\";\r\nimport {elementsSelector, toolSelector} from \"../selectors/editor\";\r\nimport {setTile} from \"../actions/tiles\";\r\nimport {useHistory, useParams} from \"react-router-dom\";\r\nimport {TileIdGenerator} from \"../idGenerators\";\r\n\r\nconst blk = bem('svg-editor');\r\n\r\nconst SvgToolbar = () => {\r\n    const dispatch = useDispatch();\r\n    const selectedTool = useSelector(toolSelector);\r\n    const elements = useSelector(elementsSelector);\r\n    const history = useHistory();\r\n\r\n    const params = useParams<{id: string}>();\r\n    const id = params.id ? parseInt(params.id) : null;\r\n\r\n    const handleSave = useCallback(() => {\r\n        dispatch(setTile({\r\n            id: id !== null ? id : TileIdGenerator.getNextId(),\r\n            elements\r\n        }));\r\n        history.push('/tiles');\r\n    }, [elements, dispatch, history, id]);\r\n\r\n    return (\r\n        <div className={blk('toolbar')}>\r\n            <button className=\"button\" onClick={handleSave}>Save</button>\r\n            <div className=\"buttons has-addons is-centered\">\r\n                <button className={\"button\" + (selectedTool === Tools.SELECT ? \" is-dark\" : \"\")} onClick={() => dispatch(selectTool(Tools.SELECT))}>Select</button>\r\n                <button className={\"button\" + (selectedTool === Tools.LINE ? \" is-dark\" : \"\")} onClick={() => dispatch(selectTool(Tools.LINE))}>Line</button>\r\n                <button className={\"button\" + (selectedTool === Tools.POLYLINE ? \" is-dark\" : \"\")} onClick={() => dispatch(selectTool(Tools.POLYLINE))}>Polyline</button>\r\n                <button className={\"button\" + (selectedTool === Tools.CIRCLE ? \" is-dark\" : \"\")} onClick={() => dispatch(selectTool(Tools.CIRCLE))}>Circle</button>\r\n                <button className={\"button\" + (selectedTool === Tools.POLYGON ? \" is-dark\" : \"\")} onClick={() => dispatch(selectTool(Tools.POLYGON))}>Polygon</button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SvgToolbar;\r\n","import React, {ReactNode} from \"react\";\r\nimport bem from \"bem-ts\";\r\n\r\nconst blk = bem('scrollable');\r\n\r\nconst Scrollable = (props: {children: ReactNode}) => (\r\n    <div className={blk()}>\r\n        <div className={blk('content')}>\r\n            {props.children}\r\n        </div>\r\n    </div>\r\n)\r\n\r\nexport default Scrollable;\r\n","import {Dispatch, SetStateAction, useCallback, useEffect, useState} from \"react\";\r\n\r\nexport interface ControlProps<T> {\r\n    onChange: (val: T | null) => void;\r\n    value?: T | null;\r\n    required?: boolean;\r\n    error?: string;\r\n    [key: string]: any;\r\n}\r\n\r\nexport function useValue<T>(props: ControlProps<T>): [T | null | undefined, Dispatch<SetStateAction<T | null | undefined>>] {\r\n    const [value, setValue] = useState<T | null | undefined>(props.value);\r\n\r\n    useEffect(() => {\r\n        setValue(props.value);\r\n    }, [props.value]);\r\n\r\n    return [value, setValue];\r\n}\r\n\r\ntype Validator = (v: any) => boolean;\r\ntype Formatter<T> = (v: any, ...args: any[]) => {success: boolean, formatted: T};\r\n\r\ninterface HasToString {\r\n    toString(): string;\r\n}\r\n\r\nexport function useControlLogic<T extends HasToString>(props: ControlProps<T>, validator: Validator, formatter: Formatter<T>): [string | T, string | undefined, Dispatch<SetStateAction<T | null>>] {\r\n    const [value, setValue] = useValue(props);\r\n    const [error, setError] = useState<string>();\r\n\r\n    const handleChange = useCallback((val: any | null, ...args: any[]) => {\r\n        if (val === null) {\r\n            if (props.required) {\r\n                setError('This field is required');\r\n            } else {\r\n                setError(undefined);\r\n            }\r\n\r\n            setValue(val);\r\n            props.onChange(val);\r\n            return;\r\n        }\r\n\r\n        if (!validator(val))\r\n            return;\r\n\r\n        setValue(val);\r\n\r\n        const {success, formatted} = formatter(val, ...args);\r\n        if (success) {\r\n            props.onChange(formatted)\r\n        }\r\n    }, [setValue, props.onChange, props.required, formatter, validator]);\r\n\r\n    return [value ?? '', error ?? props.error, handleChange];\r\n}\r\n","import React, {useCallback} from \"react\";\r\nimport {ControlProps, useControlLogic} from \"./helpers\";\r\n\r\n\r\nconst IntegerControl = (props: ControlProps<number>) => {\r\n    const validator = useCallback(val => /^-?\\d*$/.test(val as string), []);\r\n    const formatter = useCallback(val => {\r\n        const i = parseInt(val, 10);\r\n        return {success: !isNaN(i), formatted: i};\r\n    }, []);\r\n\r\n    const [value, error, onChange] = useControlLogic<number>(props, validator, formatter);\r\n\r\n    const handleChange = useCallback(e => {\r\n        const val = e.target.value ?? null;\r\n        onChange(val === '' ? null : val);\r\n    }, [onChange]);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"control\">\r\n                <input type=\"number\" className=\"input\" onChange={handleChange} value={value} />\r\n            </div>\r\n            {error && <p className=\"help is-danger\">{error}</p>}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default IntegerControl;\r\n","import React, {useCallback} from \"react\";\r\nimport {ControlProps, useControlLogic} from \"./helpers\";\r\n\r\n\r\nconst FloatControl = (props: ControlProps<number>) => {\r\n    const validator = useCallback(val => /^-?\\d*(\\d\\.\\d*)?$/.test(val as string), []);\r\n    const formatter = useCallback(val => {\r\n        const i = parseFloat(val);\r\n        return {success: !isNaN(i), formatted: i};\r\n    }, []);\r\n\r\n    const [value, error, onChange] = useControlLogic<number>(props, validator, formatter);\r\n\r\n    const handleChange = useCallback(e => {\r\n        const val = e.target.value;\r\n        onChange(val === '' ? null : val);\r\n    }, [onChange]);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"control\">\r\n                <input type=\"number\" className=\"input\" onChange={handleChange} value={value} step=\"0.1\" />\r\n            </div>\r\n            {error && <p className=\"help is-danger\">{error}</p>}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default FloatControl;\r\n","import React, {useCallback} from \"react\";\r\nimport {Point} from \"../../models/svg\";\r\nimport {ControlProps} from \"./helpers\";\r\nimport FloatControl from \"./FloatControl\";\r\n\r\n\r\nconst PointControl = (props: ControlProps<Point>) => {\r\n    const handleChange = useCallback((name: string, value: number | null) => {\r\n        props.onChange({...props.value, [name]: value} as Point);\r\n    }, [props.onChange, props.value]);\r\n\r\n    return (\r\n        <div className=\"control\">\r\n            <div className=\"columns\">\r\n                <div className=\"column\">\r\n                    <span>X</span>\r\n                    <FloatControl\r\n                        onChange={val => handleChange('x', val)}\r\n                        required={props.required}\r\n                        value={props.value?.x} />\r\n                </div>\r\n                <div className=\"column\">\r\n                    <span>Y</span>\r\n                    <FloatControl\r\n                        onChange={val => handleChange('y', val)}\r\n                        required={props.required}\r\n                        value={props.value?.y} />\r\n                </div>\r\n            </div>\r\n            {props.error && <p className=\"help is-danger\">{props.error}</p>}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default PointControl;\r\n","import {Action} from \"redux\";\r\nimport {Color} from \"../reducers/palette\";\r\n\r\nexport const PALETTE_ADD_COLOR = 'PALETTE_ADD_COLOR';\r\nexport const PALETTE_REMOVE_COLOR = 'PALETTE_REMOVE_COLOR';\r\nexport const PALETTE_UPDATE_COLOR = 'PALETTE_UPDATE_COLOR';\r\n\r\nexport interface AddColorAction extends Action<typeof PALETTE_ADD_COLOR> {\r\n    id: number;\r\n    color: Color;\r\n}\r\n\r\nexport function addColor(id: number, color: Color): AddColorAction {\r\n    return {\r\n        type: PALETTE_ADD_COLOR,\r\n        id,\r\n        color\r\n    }\r\n}\r\n\r\nexport interface RemoveColorAction extends Action<typeof PALETTE_REMOVE_COLOR> {\r\n    id: number;\r\n}\r\n\r\nexport function removeColor(id: number): RemoveColorAction {\r\n    return {\r\n        type: PALETTE_REMOVE_COLOR,\r\n        id\r\n    }\r\n}\r\n\r\nexport interface UpdateColorAction extends Action<typeof PALETTE_UPDATE_COLOR> {\r\n    id: number;\r\n    color: Color;\r\n}\r\n\r\nexport function updateColor(id: number, color: Color): UpdateColorAction {\r\n    return {\r\n        type: PALETTE_UPDATE_COLOR,\r\n        id,\r\n        color\r\n    }\r\n}\r\n\r\nexport type PaletteActions = AddColorAction | RemoveColorAction | UpdateColorAction;\r\n","import {Action} from \"redux\";\r\nimport {GeneratorState} from \"../reducers/generator\";\r\nimport {PaletteState} from \"../reducers/palette\";\r\nimport {TilesState} from \"../reducers/tiles\";\r\nimport {Version} from \"../versioning\";\r\n\r\nexport const IMPORT_PROJECT = 'IMPORT_PROJECT';\r\n\r\nexport interface ProjectType {\r\n    version: Version,\r\n    generator: GeneratorState,\r\n    tiles: TilesState,\r\n    palette: PaletteState\r\n}\r\n\r\nexport interface ImportProjectAction extends Action<typeof IMPORT_PROJECT> {\r\n    data: ProjectType;\r\n}\r\n\r\nexport function importProject(data: ProjectType): ImportProjectAction {\r\n    return {\r\n        type: IMPORT_PROJECT,\r\n        data\r\n    }\r\n}\r\n\r\nexport type GlobalActions = ImportProjectAction;\r\n","import {PALETTE_ADD_COLOR, PALETTE_REMOVE_COLOR, PALETTE_UPDATE_COLOR, PaletteActions} from \"../actions/palette\";\r\nimport {GlobalActions, IMPORT_PROJECT} from \"../actions\";\r\n\r\nexport type Color = string;\r\n\r\nexport interface PaletteState {\r\n    [id: number]: Color\r\n}\r\n\r\nexport const defaultColor = '#000';\r\n\r\nconst initialState: PaletteState = {\r\n    0: defaultColor\r\n}\r\n\r\nexport function palette(state = initialState, action: PaletteActions | GlobalActions): PaletteState {\r\n    switch (action.type) {\r\n        case PALETTE_ADD_COLOR:\r\n            return {...state, [action.id]: action.color};\r\n        case PALETTE_REMOVE_COLOR:\r\n            const {[action.id]: toRemove, ...newState} = state;\r\n            return newState;\r\n        case PALETTE_UPDATE_COLOR:\r\n            return {...state, [action.id]: action.color};\r\n        case IMPORT_PROJECT:\r\n            return JSON.parse(JSON.stringify(action.data.palette));\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n","import React, {useCallback, useEffect, useRef, useState} from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {paletteSelector} from \"../../selectors/palette\";\r\nimport {addColor, removeColor, updateColor} from \"../../actions/palette\";\r\nimport { ChromePicker } from 'react-color'\r\nimport {defaultColor} from \"../../reducers/palette\";\r\nimport {ControlProps, useValue} from \"./helpers\";\r\nimport {PaletteIdGenerator} from \"../../idGenerators\";\r\n\r\n\r\nconst blk = bem('palette-picker');\r\n\r\nconst NoColorSvg = () => (\r\n    <svg viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\" className={blk('colornone')}>\r\n        <polyline points=\"0,0 100,0 100,100 0,100 0,0\" stroke=\"#000\" strokeWidth=\"2\" fill=\"none\" />\r\n        <line x1=\"100\" y1=\"0\" x2=\"0\" y2=\"100\" stroke=\"#000\" strokeWidth=\"2\" />\r\n        <line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"#000\" strokeWidth=\"2\" />\r\n    </svg>\r\n);\r\n\r\ninterface PickerItemProps {\r\n    id: number | null,\r\n    color?: string,\r\n    canEdit?: boolean,\r\n    onDelete?: (id: number) => void,\r\n    onSelect?: (id: number | null) => void,\r\n    selected?: boolean;\r\n    ref?: (ref: any) => void;\r\n}\r\n\r\nconst PickerItem = React.forwardRef((props: PickerItemProps, ref: any) => {\r\n    const { id, color, canEdit, onDelete, onSelect, selected } = props;\r\n    const [editOpen, setEditOpen] = useState(false);\r\n    const dispatch = useDispatch();\r\n\r\n    const openEdit = useCallback((e) => {\r\n        e.stopPropagation();\r\n        setEditOpen(true);\r\n    }, [setEditOpen]);\r\n\r\n    const closeEdit = useCallback((e) => {\r\n        e.stopPropagation();\r\n        setEditOpen(false);\r\n    }, [setEditOpen]);\r\n\r\n    const handleEdit = useCallback((color) => {\r\n        dispatch(updateColor(id as number, color.hex));\r\n    }, [dispatch, id]);\r\n\r\n    return (\r\n        <div ref={ref} onClick={() => onSelect && onSelect(id)} className={blk('item', selected ? ['active'] : [])}>\r\n            <div className={blk('info')}>\r\n                <span className={blk('thumb')} style={{backgroundColor: color}}>\r\n                    {!color && <NoColorSvg />}\r\n                </span>\r\n                <span className={blk('label')}>{color ?? 'None'}</span>\r\n            </div>\r\n            {typeof id === 'number' && <div className={blk('actions')}>\r\n                {canEdit && <button onClick={openEdit} className={blk('action', ['edit'])}>\r\n                    <span className=\"icon\">\r\n                        <i className=\"fas fa-pen\" />\r\n                    </span>\r\n                </button>}\r\n                {onDelete && <button onClick={() => onDelete(id)} className={blk('action', ['delete'])}>\r\n                    <span className=\"icon\">\r\n                        <i className=\"fas fa-trash\" />\r\n                    </span>\r\n                </button>}\r\n            </div>}\r\n            {editOpen && <div className={blk('popover')}>\r\n                <div className={blk('overlay')} onClick={closeEdit} />\r\n                <ChromePicker color={color} onChangeComplete={handleEdit} />\r\n            </div>}\r\n        </div>\r\n    )\r\n})\r\n\r\n\r\nconst PalettePickerControl = (props: ControlProps<number>) => {\r\n    const [value, setValue] = useValue(props);\r\n    const palette = useSelector(paletteSelector);\r\n    const ids = Object.keys(palette).map(k => parseInt(k, 10));\r\n    const selectedRef = useRef();\r\n    const dispatch = useDispatch();\r\n\r\n    const handleSelection = useCallback((id: number | null) => {\r\n        setValue(id);\r\n        props.onChange(id);\r\n    }, [setValue, props.onChange]);\r\n\r\n    const handleDelete = useCallback((id: number | null) => {\r\n        dispatch(removeColor(id as number));\r\n    }, [dispatch]);\r\n\r\n    const handleAddColor = useCallback(() => {\r\n        dispatch(addColor(PaletteIdGenerator.getNextId(), defaultColor));\r\n    }, [dispatch]);\r\n\r\n    useEffect(() => {\r\n        (selectedRef.current as any)?.scrollIntoView();\r\n    }, []);\r\n\r\n    return (\r\n        <div className={blk()}>\r\n            <div className={blk('input')}>\r\n                {!props.required && <PickerItem id={null} onSelect={handleSelection} selected={value === null} />}\r\n                {ids.map(id => (\r\n                    <PickerItem id={id} key={id} color={palette[id]}\r\n                                canEdit\r\n                                onDelete={id === 0 ? undefined : handleDelete}\r\n                                onSelect={handleSelection}\r\n                                selected={value === id}\r\n                                ref={value === id ? selectedRef : undefined}\r\n                    />\r\n                ))}\r\n\r\n                <div onClick={handleAddColor} className={blk('item', ['new'])}>\r\n                    <span className=\"icon\">\r\n                        <i className=\"fas fa-plus\" />\r\n                    </span>\r\n                    Add color\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default PalettePickerControl;\r\n","import React, {useCallback, useState} from \"react\";\r\nimport {ControlProps} from \"./helpers\";\r\nimport {Validator} from \"../../properties/Validator\";\r\n\r\ninterface Props<T> extends ControlProps<T>{\r\n    label: string;\r\n    control: React.ElementType;\r\n    validators?: Validator<T>[];\r\n}\r\n\r\nfunction Field<T>(props: Props<T>) {\r\n    const {control: Control, label, onChange, validators, ...controlProps} = props;\r\n    const [error, setError] = useState<string>();\r\n\r\n    const handleChange = useCallback((value: T | null) => {\r\n        for (const validator of (validators ?? [])) {\r\n            const err = validator(value);\r\n            if (err) {\r\n                setError(err);\r\n                return;\r\n            }\r\n        }\r\n        setError(undefined);\r\n\r\n        onChange(value);\r\n    }, [onChange, validators]);\r\n    return (\r\n        <div className=\"field\">\r\n            <label className=\"label\">\r\n                {label}\r\n            </label>\r\n            <Control onChange={handleChange} error={error} {...controlProps} />\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Field;\r\n","import React, {useCallback, useState} from \"react\";\r\nimport {PropertyType} from \"../properties/PropertyType\";\r\nimport IntegerControl from \"./controls/IntegerControl\";\r\nimport FloatControl from \"./controls/FloatControl\";\r\nimport PointControl from \"./controls/PointControl\";\r\nimport PalettePickerControl from \"./controls/PalettePickerControl\";\r\nimport {PropertyDefinition, PropertyDefinitions} from \"../properties/PropertyDefinition\";\r\nimport {Validator} from \"../properties/Validator\";\r\nimport Field from \"./controls/Field\";\r\n\r\nconst propertyControlMap = {\r\n    [PropertyType.INTEGER]: IntegerControl,\r\n    [PropertyType.FLOAT]: FloatControl,\r\n    [PropertyType.POINT]: PointControl,\r\n    [PropertyType.COLOR]: PalettePickerControl,\r\n}\r\n\r\ninterface PropertyInputProps<T> {\r\n    property: PropertyDefinition<T>;\r\n    propName: string;\r\n    value: T | null;\r\n    onChange: (propName: string, value: T | null) => void;\r\n}\r\n\r\nfunction PropertyInput<T>(props: PropertyInputProps<T>) {\r\n    const Control = propertyControlMap[props.property.type];\r\n\r\n    const handleChange = useCallback(value => {\r\n        props.onChange(props.propName, value);\r\n    }, [props.onChange, props.propName]);\r\n\r\n    return (\r\n        <Field\r\n            control={Control}\r\n            label={props.property.label}\r\n            value={props.value as any}\r\n            onChange={handleChange as any}\r\n            required={props.property.required}\r\n            validators={props.property.validators}\r\n        />\r\n    )\r\n}\r\n\r\ninterface Props {\r\n    definitions: PropertyDefinitions;\r\n    valueAccessor: (key: string) => any;\r\n    onChange: (key: string, value: any) => void;\r\n}\r\n\r\nconst PropertyEditor = (props: Props) => {\r\n    const properties = Object.keys(props.definitions);\r\n\r\n    return (\r\n        <div>\r\n            {properties.map(prop =>\r\n                <PropertyInput<any>\r\n                    key={prop}\r\n                    property={props.definitions[prop]}\r\n                    propName={prop}\r\n                    value={props.valueAccessor(prop)}\r\n                    onChange={props.onChange}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default PropertyEditor\r\n","import React, {useCallback} from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {selectedIdxSelector, shapeSelector} from \"../selectors/editor\";\r\nimport {propertiesMap} from \"../models/svg\";\r\nimport {elemPropChange} from \"../actions/editor\";\r\nimport Scrollable from \"./Scrollable\";\r\nimport PropertyEditor from \"./PropertyEditor\";\r\n\r\n\r\nconst blk = bem('svg-properties');\r\n\r\nconst SvgPropertyEditor = () => {\r\n    const selectedIdx = useSelector(selectedIdxSelector);\r\n    const shape = useSelector(shapeSelector(selectedIdx ?? 0));\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const handleChange = useCallback((key: string, value: any) => {\r\n        dispatch(elemPropChange(selectedIdx as number, key, value));\r\n    }, [selectedIdx, dispatch]);\r\n\r\n    const propAccessor = useCallback(prop => {\r\n        return shape[prop];\r\n    }, [shape]);\r\n\r\n    return (\r\n        <div className={blk()}>\r\n            <Scrollable>\r\n                <h2 className={\"title \" + blk('title')}>Properties</h2>\r\n\r\n                {selectedIdx === null ?\r\n                    <p className={blk('text', ['unselected'])}>No shape selected</p>\r\n                    :\r\n                    <PropertyEditor\r\n                        definitions={propertiesMap[shape.type]}\r\n                        valueAccessor={propAccessor}\r\n                        onChange={handleChange}\r\n                    />\r\n                }\r\n            </Scrollable>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SvgPropertyEditor;\r\n","import React, {EventHandler, ReactNode, SyntheticEvent} from \"react\";\r\n\r\ninterface Props {\r\n    svgRef?: (el: SVGSVGElement) => void;\r\n    blk?: (element: string) => string;\r\n    eventHandlers?: {\r\n        onClick?: EventHandler<SyntheticEvent>;\r\n        onMouseMove?: EventHandler<SyntheticEvent>;\r\n        onMouseLeave?: EventHandler<SyntheticEvent>;\r\n        onContextMenu?: EventHandler<SyntheticEvent>;\r\n    };\r\n    children?: ReactNode;\r\n    overlay?: ReactNode;\r\n    padding?: number;\r\n    width?: number;\r\n    height?: number;\r\n}\r\n\r\nconst SvgCanvas = (props: Props) => {\r\n    const padding = props.padding ?? 0;\r\n    const blk = props.blk ?? (() => '');\r\n    return (\r\n        <svg preserveAspectRatio=\"xMidYMid meet\" ref={props.svgRef} width={props.width} height={props.height} viewBox={`${0 - padding} ${0 - padding} ${100 + padding*2} ${100 + padding*2}`} className={blk('svg')} {...props.eventHandlers}>\r\n            {props.children}\r\n            {props.overlay && <g className=\"no-pointer-events\">\r\n                {props.overlay}\r\n            </g>}\r\n        </svg>\r\n    )\r\n}\r\n\r\nexport default SvgCanvas;\r\n","import React from \"react\";\r\n\r\ninterface Props {\r\n    gridSize: number;\r\n}\r\n\r\nconst SvgGrid = (props: Props) => {\r\n    const gridLinesCount = 100/props.gridSize + 1;\r\n    const grid = props.gridSize;\r\n    const lines = Array(gridLinesCount).fill(0);\r\n    return (\r\n        <>\r\n            {lines.map((_, idx) =>\r\n                <line key={idx} x1={0} y1={idx * grid} x2={100} y2={idx * grid} stroke=\"#999\" strokeOpacity={0.5}\r\n                      strokeWidth={1} vectorEffect=\"non-scaling-stroke\"/>\r\n            )}\r\n            {lines.map((_, idx) =>\r\n                <line key={idx} y1={0} x1={idx * grid} y2={100} x2={idx * grid} stroke=\"#999\" strokeOpacity={0.5}\r\n                        strokeWidth={1} vectorEffect=\"non-scaling-stroke\"/>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default SvgGrid;\r\n","import {TheState} from \"../reducers\";\r\nimport Tile from \"../models/Tile\";\r\n\r\nexport const tilesSelector = (state: TheState): Tile[] => state.tiles;\r\nexport const tileSelector = (id: number | null) => (state: TheState): Tile | undefined => state.tiles.find(t => t.id === id);\r\n","import React, {SyntheticEvent, useCallback, useEffect, useState} from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport SvgCanvas from \"./SvgCanvas\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {elementsSelector, gridSizeSelector, selectedIdxSelector, toolSelector} from \"../selectors/editor\";\r\nimport SvgGrid from \"./SvgGrid\";\r\nimport {Point} from \"../models/svg\";\r\nimport {useTool} from \"../editor-tools\";\r\nimport SvgShapeRenderer from \"./SvgShapeRenderer\";\r\nimport {ToolType} from \"../editor-tools/Tool\";\r\nimport {clear, setElements} from \"../actions/editor\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport {tileSelector} from \"../selectors/tiles\";\r\n\r\nconst blk = bem('svg-editor');\r\n\r\nconst useSvgUtils: () => [(el: SVGSVGElement) => void, (e: SyntheticEvent, grid: number) => Point] = () => {\r\n    const [svg, setSvgRef] = useState(null);\r\n    const [svgPoint, setSvgPoint] = useState(null);\r\n    const ref = useCallback(el => {\r\n        if (el !== null) {\r\n            setSvgRef(el);\r\n            setSvgPoint(el.createSVGPoint());\r\n        }\r\n    }, [setSvgRef]);\r\n\r\n    const eventToSvgCoords = useCallback<(e: SyntheticEvent, grid: number) => Point>((e, grid): Point => {\r\n        if (svgPoint === null)\r\n            return {x: 0, y: 0};\r\n        // @ts-ignore\r\n        svgPoint.x = e.clientX;\r\n        // @ts-ignore\r\n        svgPoint.y = e.clientY;\r\n\r\n        // @ts-ignore\r\n        const transformed = svgPoint.matrixTransform(svg.getScreenCTM()?.inverse());\r\n        return {\r\n            x: Math.round(transformed.x / grid) * grid,\r\n            y: Math.round(transformed.y / grid) * grid,\r\n        };\r\n    }, [svgPoint, svg]);\r\n\r\n    return [ref, eventToSvgCoords];\r\n}\r\n\r\nfunction isInBounds(p: Point) {\r\n    return p.x >= 0 && p.y >= 0 && p.x <= 100 && p.y <= 100;\r\n}\r\n\r\nconst SvgEditorCanvas = () => {\r\n    const [svgRef, eventToSvgCoords] = useSvgUtils();\r\n    const grid = useSelector(gridSizeSelector);\r\n    const selectedTool = useSelector(toolSelector);\r\n    const selectedIdx = useSelector(selectedIdxSelector);\r\n    const elements = useSelector(elementsSelector);\r\n    const [hoverPoint, setHoverPoint] = useState<Point | null>(null);\r\n    const tool = useTool(selectedTool);\r\n    const dispatch = useDispatch();\r\n\r\n    const params = useParams<{id: string}>();\r\n    const id = params.id ? parseInt(params.id) : null;\r\n    const tile = useSelector(tileSelector(id));\r\n\r\n    const handleClick = useCallback((e) => {\r\n        const point = eventToSvgCoords(e, grid);\r\n        if (isInBounds(point)) {\r\n            tool.svgEventHandlers.onClick(point);\r\n        }\r\n    }, [eventToSvgCoords, grid, tool.svgEventHandlers.onClick]);\r\n\r\n    const handleMouseMove = useCallback(e => {\r\n        const point = eventToSvgCoords(e, grid);\r\n        if (isInBounds(point)) {\r\n            setHoverPoint(point);\r\n        }\r\n    }, [grid, eventToSvgCoords]);\r\n\r\n    const handleMouseExit = useCallback(e => {\r\n        setHoverPoint(null);\r\n        const point = eventToSvgCoords(e, grid);\r\n        if (isInBounds(point)) {\r\n            tool.svgEventHandlers.onMouseLeave(point);\r\n        }\r\n    }, [setHoverPoint, eventToSvgCoords, grid, tool.svgEventHandlers.onMouseLeave]);\r\n\r\n    const handleShapeClick = useCallback((e: SyntheticEvent, idx) => {\r\n        if (tool.toolType === ToolType.MANIPULATOR) {\r\n            e.stopPropagation();\r\n            tool.onShapeClick(idx, elements[idx]);\r\n        }\r\n    }, [tool.onShapeClick, elements]);\r\n\r\n    const handleContextMenu = useCallback((e: SyntheticEvent) => {\r\n        e.preventDefault();\r\n        tool.svgEventHandlers.onFinish();\r\n    }, [tool.svgEventHandlers.onFinish]);\r\n\r\n    useEffect(() => {\r\n        hoverPoint && tool.svgEventHandlers.onMouseMove(hoverPoint);\r\n    }, [hoverPoint]);\r\n\r\n    useEffect(() => {\r\n        dispatch(clear());\r\n        if (id !== null && tile) {\r\n            dispatch(setElements(tile.elements));\r\n        }\r\n    }, [id, tile, dispatch]);\r\n\r\n    return (\r\n        <SvgCanvas svgRef={svgRef} blk={blk}\r\n                   padding={grid / 2}\r\n                   eventHandlers={{\r\n                       onClick: handleClick,\r\n                       onMouseMove: handleMouseMove,\r\n                       onMouseLeave: handleMouseExit,\r\n                       onContextMenu: handleContextMenu\r\n                   }}\r\n                   overlay={\r\n                       <>\r\n                           <SvgGrid gridSize={grid} />\r\n                           {hoverPoint && tool.showHoverPoint &&\r\n                           <circle cx={hoverPoint.x} cy={hoverPoint.y} r={1} stroke=\"black\" strokeWidth={2}\r\n                                   vectorEffect=\"non-scaling-stroke\"/>}\r\n                       </>\r\n                   }\r\n        >\r\n            <SvgCanvas width={100} height={100}>\r\n                {elements.map((el, idx) => <SvgShapeRenderer key={el.id} selected={idx === selectedIdx} shape={el} eventHandlers={{onClick: (e: SyntheticEvent) => handleShapeClick(e, idx)}} />)}\r\n                {tool.renderedShape}\r\n            </SvgCanvas>\r\n        </SvgCanvas>\r\n    )\r\n}\r\n\r\nexport default SvgEditorCanvas;\r\n","import React, {SyntheticEvent, useCallback} from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {elementsSelector, selectedIdxSelector} from \"../selectors/editor\";\r\nimport SvgCanvas from \"./SvgCanvas\";\r\nimport SvgShapeRenderer from \"./SvgShapeRenderer\";\r\nimport {SvgShape, SvgShapeType} from \"../models/svg\";\r\nimport Scrollable from \"./Scrollable\";\r\nimport {deleteElement, selectShape, setElements} from \"../actions/editor\";\r\nimport {DragDropContext, Draggable, Droppable} from \"react-beautiful-dnd\";\r\nimport {reorder} from \"../utils\";\r\n\r\nconst blk = bem('svg-element-viewer');\r\n\r\nconst shapeToLabel = (shape: SvgShape): string => {\r\n    let type = 'Unknown';\r\n\r\n    switch (shape.type) {\r\n        case SvgShapeType.TYPE_POLYGON:\r\n            type = 'Polygon';\r\n            break;\r\n        case SvgShapeType.TYPE_CIRCLE:\r\n            type = 'Circle';\r\n            break;\r\n        case SvgShapeType.TYPE_POLYLINE:\r\n            type = 'Polyline';\r\n            break;\r\n        case SvgShapeType.TYPE_LINE:\r\n            type = 'Line';\r\n            break;\r\n    }\r\n\r\n    return `${type} #${shape.id}`;\r\n}\r\n\r\nconst SvgElementViewer = () => {\r\n    const elements = useSelector(elementsSelector);\r\n    const selectedIdx = useSelector(selectedIdxSelector);\r\n    const dispatch = useDispatch();\r\n\r\n    const handleSelect = useCallback((e: SyntheticEvent, idx: number) => {\r\n        e.stopPropagation();\r\n        dispatch(selectShape(elements.length - idx - 1));\r\n    }, [dispatch, elements]);\r\n\r\n    const handleDragEnd = useCallback((result) => {\r\n        if (!result.destination) {\r\n            return;\r\n        }\r\n        dispatch(setElements(reorder(\r\n            elements,\r\n            elements.length - result.source.index - 1,\r\n            elements.length - result.destination.index - 1\r\n        )));\r\n    }, [elements, dispatch]);\r\n\r\n    const handleDelete = useCallback((e: SyntheticEvent, id: number) => {\r\n        e.stopPropagation();\r\n        dispatch(deleteElement(id));\r\n    }, [dispatch]);\r\n\r\n    const handleDeselect = useCallback(() => {\r\n        dispatch(selectShape(null));\r\n    }, [dispatch]);\r\n\r\n    const elementsReversed = [...elements];\r\n    elementsReversed.reverse();\r\n\r\n    return (\r\n        <DragDropContext onDragEnd={handleDragEnd}>\r\n            <div className={blk()} onClick={handleDeselect}>\r\n                <Scrollable>\r\n                    <div className={blk('content')}>\r\n                        <h2 className=\"title\">Elements</h2>\r\n                        <Droppable droppableId=\"elements\">\r\n                            {((provided, snapshot) => (\r\n                                <div\r\n                                    {...provided.droppableProps}\r\n                                    ref={provided.innerRef}\r\n                                    className={blk('items')}\r\n                                >\r\n                                    {elementsReversed.map((el, idx) =>\r\n                                        <Draggable draggableId={el.id.toString()} index={idx} key={el.id}>\r\n                                            {(innerProvided) => (\r\n                                                <div\r\n                                                    key={el.id}\r\n                                                    onClick={(e) => handleSelect(e, idx)}\r\n                                                    className={blk('item', selectedIdx ===  elements.length - idx - 1 ? ['active'] : [])}\r\n                                                    {...innerProvided.draggableProps}\r\n                                                    {...innerProvided.dragHandleProps}\r\n                                                    ref={innerProvided.innerRef}\r\n                                                >\r\n                                                    <div className={blk('info')}>\r\n                                                        <div className={blk('thumb')}>\r\n                                                            <SvgCanvas blk={blk}>\r\n                                                                <SvgShapeRenderer shape={el} />\r\n                                                            </SvgCanvas>\r\n                                                        </div>\r\n                                                        <div className={blk('label')}>\r\n                                                            {shapeToLabel(el)}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className={blk('actions')}>\r\n                                                        <button onClick={(e) => handleDelete(e, el.id)} className={blk('action', ['delete'])}>\r\n                                                            <span className=\"icon\">\r\n                                                                <i className=\"fas fa-trash\" />\r\n                                                            </span>\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n                                        </Draggable>\r\n                                    )}\r\n                                    {provided.placeholder}\r\n                                </div>\r\n                            ))}\r\n                        </Droppable>\r\n                    </div>\r\n                </Scrollable>\r\n            </div>\r\n        </DragDropContext>\r\n    )\r\n}\r\n\r\nexport default SvgElementViewer;\r\n","import React from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport PanelLayout from \"../layouts/PanelLayout\";\r\nimport SvgToolbar from \"./SvgToolbar\";\r\nimport SvgPropertyEditor from \"./SvgPropertyEditor\";\r\nimport SvgEditorCanvas from \"./SvgEditorCanvas\";\r\nimport SvgElementViewer from \"./SvgElementViewer\";\r\nimport ErrorBoundary from \"./ErrorBoundary\";\r\n\r\nconst blk = bem('svg-editor');\r\n\r\nconst SvgEditor = () => {\r\n    return (\r\n        <div className={blk()}>\r\n            <PanelLayout horizontal left={<SvgElementViewer />} right={<SvgPropertyEditor />}>\r\n                <PanelLayout left={<SvgToolbar />}>\r\n                    <div className={blk('wrap')}>\r\n                        <div className={blk('content')}>\r\n                            <ErrorBoundary>\r\n                                <SvgEditorCanvas />\r\n                            </ErrorBoundary>\r\n                        </div>\r\n                    </div>\r\n                </PanelLayout>\r\n            </PanelLayout>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default SvgEditor;\r\n","import FullscreenPageLayout from \"layouts/FullscreenPageLayout\";\r\nimport React from \"react\";\r\nimport Navbar from \"../../components/Navbar\";\r\nimport Footer from \"../../components/Footer\";\r\nimport SvgEditor from \"../../components/SvgEditor\";\r\n\r\nconst TileEditor = () => {\r\n    return (\r\n        <FullscreenPageLayout header={<Navbar />} footer={<Footer />}>\r\n            <SvgEditor />\r\n        </FullscreenPageLayout>\r\n    );\r\n}\r\n\r\nexport default TileEditor;\r\n","import {Action} from \"redux\";\r\n\r\nexport const GENERATOR_SET_ROWS = 'GENERATOR_SET_ROWS';\r\nexport const GENERATOR_SET_COLS = 'GENERATOR_SET_COLS';\r\nexport const GENERATOR_SET_SELECTOR = 'GENERATOR_SET_SELECTOR';\r\nexport const GENERATOR_SET_SELECTOR_PROPERTY = 'GENERATOR_SET_SELECTOR_PROPERTY';\r\nexport const GENERATOR_SET_BACKGROUND = 'GENERATOR_SET_BACKGROUND';\r\n\r\nexport interface SetRowsAction extends Action<typeof GENERATOR_SET_ROWS> {\r\n    rows: number;\r\n}\r\n\r\nexport function setRows(rows: number): SetRowsAction {\r\n    return {\r\n        type: GENERATOR_SET_ROWS,\r\n        rows\r\n    }\r\n}\r\n\r\nexport interface SetColsAction extends Action<typeof GENERATOR_SET_COLS> {\r\n    cols: number;\r\n}\r\n\r\nexport function setCols(cols: number): SetColsAction {\r\n    return {\r\n        type: GENERATOR_SET_COLS,\r\n        cols\r\n    }\r\n}\r\n\r\nexport interface SetSelectorAction extends Action<typeof GENERATOR_SET_SELECTOR> {\r\n    selector: string;\r\n}\r\n\r\nexport function setSelector(selector: string): SetSelectorAction {\r\n    return {\r\n        type: GENERATOR_SET_SELECTOR,\r\n        selector\r\n    }\r\n}\r\n\r\nexport interface SetSelectorPropertyAction extends Action<typeof GENERATOR_SET_SELECTOR_PROPERTY> {\r\n    prop: string;\r\n    value: any;\r\n}\r\n\r\nexport function setSelectorProperty(prop: string, value: any): SetSelectorPropertyAction {\r\n    return {\r\n        type: GENERATOR_SET_SELECTOR_PROPERTY,\r\n        prop,\r\n        value\r\n    }\r\n}\r\n\r\nexport interface SetBackgroundAction extends Action<typeof GENERATOR_SET_BACKGROUND> {\r\n    backgroundColorId: number | null;\r\n}\r\n\r\nexport function setBackground(backgroundColorId: number | null): SetBackgroundAction {\r\n    return {\r\n        type: GENERATOR_SET_BACKGROUND,\r\n        backgroundColorId\r\n    }\r\n}\r\n\r\nexport type GeneratorActions = SetRowsAction | SetColsAction | SetSelectorAction | SetSelectorPropertyAction | SetBackgroundAction;\r\n","import {TheState} from \"../reducers\";\r\n\r\nexport const rowsSelector = (state: TheState): number => state.generator.rows;\r\nexport const colsSelector = (state: TheState): number => state.generator.cols;\r\nexport const tileSelectorKeySelector = (state: TheState): string => state.generator.tileSelector;\r\nexport const tileSelectorPropertiesSelector = (state: TheState): any => state.generator.tileSelectorProperties;\r\nexport const backgroundColorIdSelector = (state: TheState): null | number => state.generator.backgroundColorId;\r\n","import {ControlProps, useControlLogic} from \"./helpers\";\r\nimport React, {ReactNode, useCallback} from \"react\";\r\n\r\ntype KeyType = string | number;\r\n\r\ninterface Props<T extends KeyType> extends ControlProps<T> {\r\n    choices: {\r\n        key: T | null;\r\n        label: ReactNode;\r\n    }[];\r\n}\r\n\r\nexport default function SelectControl<T extends KeyType>(props: Props<T>) {\r\n    const validator = useCallback(_ => true, []);\r\n    const formatter = useCallback(val => {\r\n        return {success: true, formatted: val};\r\n    }, []);\r\n\r\n    const [value, error, onChange] = useControlLogic<T>(props, validator, formatter);\r\n\r\n    const handleChange = useCallback(e => {\r\n        const val = e.target.value;\r\n        onChange(val);\r\n    }, [onChange]);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"control\">\r\n                <div className=\"select\">\r\n                    <select className=\"input\" onChange={handleChange} value={value as string}>\r\n                        {props.choices && props.choices.map(choice => (\r\n                            <option key={choice.key} value={choice.key as any}>{choice.label}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n            {error && <p className=\"help is-danger\">{error}</p>}\r\n        </>\r\n    )\r\n}\r\n","\r\nexport default interface Selector<T, S> {\r\n    label: string;\r\n    description?: string;\r\n    defaultProperties: T;\r\n    state?: S,\r\n    selectTile(idx: number, x: number, y: number, properties: T): number;\r\n}\r\n\r\nexport function bindSelector<T, S>(selector: Selector<T, S>): Selector<T, S> {\r\n    selector.selectTile = selector.selectTile.bind(selector);\r\n    return selector;\r\n}\r\n","import {PropertyType} from \"./PropertyType\";\r\nimport {Validator} from \"./Validator\";\r\nimport {PropertyDefinitions} from \"./PropertyDefinition\";\r\n\r\nexport function Property<T> (type: PropertyType, label: string, required?: boolean, validators?: Validator<T | null>[]) {\r\n    return (target: any, key: string) => {\r\n        if (!('__propertyDefinitions' in target)) {\r\n            Object.defineProperty(target, '__propertyDefinitions', {value: {}});\r\n        }\r\n\r\n        target.__propertyDefinitions[key] = {\r\n            type,\r\n            label,\r\n            required,\r\n            validators\r\n        }\r\n    }\r\n}\r\n\r\nexport function getPropertyDefinitions(obj: any): PropertyDefinitions {\r\n    return obj.__propertyDefinitions ?? {};\r\n}\r\n","import Selector, {bindSelector} from \"./Selector\";\r\nimport {Property} from \"../properties/decorators\";\r\nimport {PropertyType} from \"../properties/PropertyType\";\r\nimport {MinValidator} from \"../properties/validators\";\r\n\r\nexport class LinearSelectorProperties {\r\n    constructor(step: number, offset: number) {\r\n        this.step = step;\r\n        this.offset = offset;\r\n    }\r\n\r\n    @Property<number>(PropertyType.INTEGER, 'Step', true, [MinValidator(0)])\r\n    step: number;\r\n\r\n    @Property<number>(PropertyType.INTEGER, 'Offset', true, [MinValidator(0)])\r\n    offset: number;\r\n}\r\n\r\nexport const LinearSelector: Selector<LinearSelectorProperties, {}> = bindSelector({\r\n    label: 'Linear selector',\r\n    description: 'step * index + offset',\r\n    defaultProperties: new LinearSelectorProperties(1, 0),\r\n    selectTile(idx: number, x: number, y: number, properties: LinearSelectorProperties): number {\r\n        return properties.step as number * idx + properties.offset as number;\r\n    }\r\n})\r\n\r\nexport class GeometricSelectorProperties {\r\n    constructor(q: number, initial: number) {\r\n        this.q = q;\r\n        this.initial = initial;\r\n    }\r\n\r\n    @Property<number>(PropertyType.FLOAT, 'q', true, [MinValidator(0)])\r\n    q: number;\r\n\r\n    @Property<number>(PropertyType.INTEGER, 'Initial', true, [MinValidator(0)])\r\n    initial: number;\r\n}\r\n\r\nexport const GeometricSelector: Selector<GeometricSelectorProperties, {last: number}> = bindSelector({\r\n    label: 'Geometric selector',\r\n    description: 'lastValue * q',\r\n    defaultProperties: new GeometricSelectorProperties(1.5, 1),\r\n    state: {last: 0},\r\n    selectTile(idx: number, x: number, y: number, properties: GeometricSelectorProperties): number {\r\n        if (idx === 0) {\r\n            this.state = {last: properties.initial};\r\n        }\r\n        // @ts-ignore\r\n        this.state.last = (this.state?.last ?? 1) * properties.q;\r\n        // @ts-ignore\r\n        return this.state.last;\r\n    }\r\n})\r\n\r\nexport class FibonacciSelectorProperties {\r\n}\r\n\r\nexport const FibonacciSelector: Selector<FibonacciSelectorProperties, {n1: number, n2: number}> = bindSelector({\r\n    label: 'Fibonacci selector',\r\n    description: 'Selector using Fibonacci series',\r\n    defaultProperties: new FibonacciSelectorProperties(),\r\n    state: {n1: 1, n2: 1},\r\n    selectTile(idx: number, x: number, y: number, properties: FibonacciSelectorProperties): number {\r\n        if (idx === 0) {\r\n            this.state = {n1: 1, n2: 1};\r\n            return 1;\r\n        } else if (idx === 1) {\r\n            return 1;\r\n        }\r\n        const tmp = this.state?.n1;\r\n        // @ts-ignore\r\n        this.state.n1 = this.state.n2;\r\n        // @ts-ignore\r\n        this.state.n2 = this.state.n2 + tmp;\r\n        // @ts-ignore\r\n        return this.state.n2;\r\n    }\r\n})\r\n\r\nexport const tileSelectors = {\r\n    LinearSelector,\r\n    GeometricSelector,\r\n    FibonacciSelector\r\n}\r\n","import { tileSelectors } from \"./selectors\";\r\nimport Selector from \"./Selector\";\r\n\r\nconst generators = {\r\n    tileSelectors\r\n};\r\n\r\nexport function getTileSelectorByName(name: string): Selector<any, any> {\r\n    return (generators.tileSelectors as any)[name] as Selector<any, any>;\r\n}\r\n\r\nexport default generators;\r\n","import React from \"react\";\r\nimport Tile from \"../models/Tile\";\r\nimport SvgShapeRenderer from \"./SvgShapeRenderer\";\r\n\r\ninterface Props {\r\n    tile: Tile\r\n}\r\n\r\nconst TileSvg = ({tile}: Props) => {\r\n    return (\r\n        <svg viewBox=\"0 0 100 100\" width={100} height={100} xmlns=\"http://www.w3.org/2000/svg\">\r\n            {tile.elements.map(el => <SvgShapeRenderer shape={el} key={el.id} />)}\r\n        </svg>\r\n    )\r\n}\r\n\r\nexport default TileSvg;\r\n","import TileSvg from \"./TileSvg\";\r\nimport React, {useMemo} from \"react\";\r\nimport Tile from \"../models/Tile\";\r\nimport {getTileSelectorByName} from \"../generators\";\r\n\r\ninterface Props {\r\n    rows: number;\r\n    cols: number;\r\n    tiles: Tile[];\r\n    tileSelector: string;\r\n    tileSelectorProperties: any;\r\n    backgroundColor?: string;\r\n}\r\n\r\nconst MosaicRenderer = (props: Props) => {\r\n    const tilesLen = props.tiles.length;\r\n\r\n    const rowArray = useMemo(() => Array(props.rows).fill(0), [props.rows]);\r\n    const colArray = useMemo(() => Array(props.cols).fill(0), [props.cols]);\r\n\r\n    const tileSelector = getTileSelectorByName(props.tileSelector);\r\n\r\n    const tileMatrix = useMemo(() => {\r\n        return rowArray.map((_, row) => (\r\n            colArray.map((_, col) => {\r\n                const idx = row * props.cols + col;\r\n                const selectedTile = tileSelector.selectTile(idx, row, col, props.tileSelectorProperties);\r\n                const tile = props.tiles[Math.round(selectedTile) % tilesLen];\r\n                return tile?.id;\r\n            })\r\n        ))\r\n    }, [rowArray, colArray, tileSelector, tilesLen, props.cols, props.tiles, props.tileSelectorProperties]);\r\n\r\n    const tileDefinitions = useMemo(() => (\r\n        props.tiles.map(tile => (\r\n            <g key={tile.id} id={`tile-${tile.id}`}>\r\n                <TileSvg key={tile.id} tile={tile} />\r\n            </g>\r\n        ))\r\n    ), [props.tiles]);\r\n\r\n    return (\r\n        <svg\r\n            shapeRendering=\"crispEdges\"\r\n            version=\"1.1\"\r\n            preserveAspectRatio=\"xMidYMid meet\"\r\n            viewBox={`0 0 ${props.cols*100} ${props.rows*100}`}\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            xmlnsXlink=\"http://www.w3.org/1999/xlink\"\r\n        >\r\n            <defs>\r\n                {tileDefinitions}\r\n            </defs>\r\n            {props.backgroundColor && <rect x={0} y={0} width={props.cols * 100} height={props.rows * 100} fill={props.backgroundColor} />}\r\n            {tileMatrix.map((column, row) => (\r\n                column.map((tileId, col) => {\r\n                    return <use key={row * props.cols + col} xlinkHref={`#tile-${tileId}`} x={col * 100}\r\n                                y={row * 100}/>\r\n                })\r\n            ))}\r\n        </svg>\r\n    )\r\n}\r\n\r\nexport default MosaicRenderer;\r\n","import MosaicRenderer from \"./MosaicRenderer\";\r\nimport {useSelector} from \"react-redux\";\r\nimport {tilesSelector} from \"../selectors/tiles\";\r\nimport {\r\n    backgroundColorIdSelector,\r\n    colsSelector,\r\n    rowsSelector,\r\n    tileSelectorKeySelector,\r\n    tileSelectorPropertiesSelector\r\n} from \"../selectors/generator\";\r\nimport React from \"react\";\r\nimport {colorSelector} from \"../selectors/palette\";\r\n\r\nconst GenerateMosaic = () => {\r\n    const tiles = useSelector(tilesSelector);\r\n    const cols = useSelector(colsSelector);\r\n    const rows = useSelector(rowsSelector);\r\n    const tileSelectorKey = useSelector(tileSelectorKeySelector);\r\n    const tileSelectorProperties = useSelector(tileSelectorPropertiesSelector);\r\n    const backgroundColorId = useSelector(backgroundColorIdSelector);\r\n    const backgroundColor = useSelector(colorSelector(backgroundColorId));\r\n\r\n    return (<>\r\n        {tiles.length > 0 && <MosaicRenderer\r\n            rows={rows} cols={cols}\r\n            tiles={tiles} tileSelector={tileSelectorKey}\r\n            tileSelectorProperties={tileSelectorProperties}\r\n            backgroundColor={backgroundColor}\r\n        />}\r\n    </>);\r\n}\r\n\r\nexport default GenerateMosaic;\r\n","import {SvgShape} from \"../models/svg\";\r\nimport {\r\n    EDITOR_ADD_SHAPE, EDITOR_CLEAR, EDITOR_DELETE_ELEMENT, EDITOR_ELEM_PROP_CHANGE,\r\n    EDITOR_SELECT_SHAPE,\r\n    EDITOR_SELECT_TOOL, EDITOR_SET_ELEMENTS,\r\n    EDITOR_SET_GRID,\r\n    EditorActions\r\n} from \"../actions/editor\";\r\nimport {Tools} from \"../editor-tools\";\r\n\r\n\r\nexport interface EditorState {\r\n    elements: SvgShape[];\r\n    gridSize: number;\r\n    selectedTool: Tools;\r\n    selectedIdx: number | null;\r\n}\r\n\r\nconst initialState: EditorState = {\r\n    elements: [],\r\n    gridSize: 5,\r\n    selectedTool: Tools.SELECT,\r\n    selectedIdx: null,\r\n}\r\n\r\nexport function editor(state = initialState, action: EditorActions): EditorState {\r\n    switch (action.type) {\r\n        case EDITOR_ADD_SHAPE:\r\n            const newSelected = state.elements.length;\r\n            const elements = [...state.elements, action.shape];\r\n            return {...state, elements, selectedIdx: newSelected};\r\n        case EDITOR_SET_GRID:\r\n            return {...state, gridSize: action.size};\r\n        case EDITOR_SELECT_SHAPE:\r\n            return {...state, selectedIdx: action.idx};\r\n        case EDITOR_SELECT_TOOL:\r\n            return {...state, selectedTool: action.tool};\r\n        case EDITOR_ELEM_PROP_CHANGE:\r\n            return {...state, elements: state.elements.map(\r\n                (s, i) => i === action.elemIdx ? {...s, [action.propName]: action.value} : s\r\n            )}\r\n        case EDITOR_SET_ELEMENTS:\r\n            const newSelectedIdx = state.selectedIdx !== null\r\n                ?\r\n                action.elements.findIndex(el => el.id === state.elements[state.selectedIdx ?? 0].id)\r\n                :\r\n                null;\r\n            return {...state, elements: action.elements, selectedIdx: newSelectedIdx};\r\n        case EDITOR_DELETE_ELEMENT: {\r\n            let newSelected = state.selectedIdx;\r\n            const newElements = state.elements.filter((el, idx) => {\r\n                const isIt = el.id === action.id;\r\n                if (isIt && state.selectedIdx === idx) {\r\n                    newSelected = null;\r\n                }\r\n                return !isIt;\r\n            });\r\n            return {...state, elements: newElements, selectedIdx: newSelected};\r\n        }\r\n        case EDITOR_CLEAR:\r\n            return initialState;\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n","import Tile from \"../models/Tile\";\r\nimport {\r\n    TILES_DELETE_TILE,\r\n    TILES_DUPLICATE_TILE, TILES_ROTATE,\r\n    TILES_SET_TILE,\r\n    TILES_SET_TILES,\r\n    TilesActions\r\n} from \"../actions/tiles\";\r\nimport {Point, SvgCircle, SvgLine, SvgPolygon, SvgPolyline, SvgShapeType} from \"../models/svg\";\r\nimport {GlobalActions, IMPORT_PROJECT} from \"../actions\";\r\n\r\n\r\nexport type TilesState = Tile[];\r\n\r\nconst initialState: TilesState = [\r\n    {\r\n        id: 1,\r\n        elements: [\r\n            {\r\n                type: SvgShapeType.TYPE_POLYLINE,\r\n                zIndex: 0,\r\n                strokeColorId: 0,\r\n                strokeWidth: 2,\r\n                points: [\r\n                    {\r\n                        x: 30,\r\n                        y: 40\r\n                    },\r\n                    {\r\n                        x: 60,\r\n                        y: 75\r\n                    },\r\n                    {\r\n                        x: 90,\r\n                        y: 70\r\n                    },\r\n                    {\r\n                        x: 70,\r\n                        y: 0\r\n                    },\r\n                    {\r\n                        x: 35,\r\n                        y: 85\r\n                    }\r\n                ],\r\n                id: 1\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        id: 2,\r\n        elements: [\r\n            {\r\n                type: SvgShapeType.TYPE_LINE,\r\n                zIndex: 0,\r\n                strokeColorId: 0,\r\n                strokeWidth: 2,\r\n                point1: {\r\n                    x: 20,\r\n                    y: 35\r\n                },\r\n                point2: {\r\n                    x: 80,\r\n                    y: 85\r\n                },\r\n                id: 2\r\n            },\r\n            {\r\n                type: SvgShapeType.TYPE_LINE,\r\n                zIndex: 0,\r\n                strokeColorId: 0,\r\n                strokeWidth: 2,\r\n                point1: {\r\n                    x: 30,\r\n                    y: 80\r\n                },\r\n                point2: {\r\n                    x: 55,\r\n                    y: 30\r\n                },\r\n                id: 3\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        id: 3,\r\n        elements: [\r\n            {\r\n                type: SvgShapeType.TYPE_POLYGON,\r\n                zIndex: 0,\r\n                fillColorId: 0,\r\n                points: [\r\n                    {\r\n                        x: 75,\r\n                        y: 25\r\n                    },\r\n                    {\r\n                        x: 25,\r\n                        y: 60\r\n                    },\r\n                    {\r\n                        x: 25,\r\n                        y: 60\r\n                    },\r\n                    {\r\n                        x: 75,\r\n                        y: 85\r\n                    },\r\n                    {\r\n                        x: 75,\r\n                        y: 85\r\n                    },\r\n                    {\r\n                        x: 15,\r\n                        y: 10\r\n                    },\r\n                    {\r\n                        x: 15,\r\n                        y: 10\r\n                    }\r\n                ],\r\n                strokeColorId: null,\r\n                strokeWidth: null,\r\n                id: 4\r\n            }\r\n        ]\r\n    }\r\n];\r\n\r\nfunction rotatePoint(p: Point, ccw: boolean): Point {\r\n    const tx = p.x - 50;\r\n    const ty = p.y - 50;\r\n\r\n    return {\r\n        x: (!ccw ? -ty : ty) + 50,\r\n        y: (!ccw ? tx : -tx) + 50\r\n    }\r\n}\r\n\r\nexport function tiles(state = initialState, action: TilesActions | GlobalActions): TilesState {\r\n    switch (action.type) {\r\n        case TILES_SET_TILE:\r\n            const tileIdx = state.findIndex(t => t.id === action.tile.id);\r\n            if (tileIdx >= 0) {\r\n                return state.map(t => t.id === action.tile.id ? {...action.tile} : t);\r\n            }\r\n            return [...state, action.tile];\r\n        case TILES_DELETE_TILE:\r\n            return state.filter(tile => tile.id !== action.id);\r\n        case TILES_SET_TILES:\r\n            return [...action.tiles];\r\n        case IMPORT_PROJECT:\r\n            return JSON.parse(JSON.stringify(action.data.tiles));\r\n        case TILES_DUPLICATE_TILE: {\r\n            const tile = state[action.idx];\r\n            const duplicated = JSON.parse(JSON.stringify(tile));\r\n            duplicated.id = action.newId;\r\n\r\n            const newTiles = [...state];\r\n            newTiles.splice(action.idx + 1, 0, duplicated);\r\n            return newTiles;\r\n        }\r\n        case TILES_ROTATE: {\r\n            const elements = state[action.idx].elements.map(el => {\r\n                switch (el.type) {\r\n                    case SvgShapeType.TYPE_CIRCLE:\r\n                        const circle = el as SvgCircle;\r\n                        return {\r\n                            ...circle,\r\n                            center: rotatePoint(circle.center, action.ccw)\r\n                        }\r\n                    case SvgShapeType.TYPE_LINE:\r\n                        const line = el as SvgLine;\r\n                        return {\r\n                            ...line,\r\n                            point1: rotatePoint(line.point1, action.ccw),\r\n                            point2: rotatePoint(line.point2, action.ccw)\r\n                        }\r\n                    case SvgShapeType.TYPE_POLYGON:\r\n                        const polygon = el as SvgPolygon;\r\n                        return {\r\n                            ...polygon,\r\n                            points: polygon.points.map(p => rotatePoint(p, action.ccw))\r\n                        }\r\n                    case SvgShapeType.TYPE_POLYLINE:\r\n                        const polyline = el as SvgPolyline;\r\n                        return {\r\n                            ...polyline,\r\n                            points: polyline.points.map(p => rotatePoint(p, action.ccw))\r\n                        }\r\n                    default:\r\n                        return el;\r\n                }\r\n            });\r\n            const tiles = [...state];\r\n            tiles[action.idx] = {...state[action.idx], elements};\r\n            return tiles;\r\n        }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n","import {\r\n    GENERATOR_SET_BACKGROUND,\r\n    GENERATOR_SET_COLS,\r\n    GENERATOR_SET_ROWS,\r\n    GENERATOR_SET_SELECTOR,\r\n    GENERATOR_SET_SELECTOR_PROPERTY,\r\n    GeneratorActions\r\n} from \"../actions/generator\";\r\nimport {LinearSelector} from \"../generators/selectors\";\r\nimport {varToString} from \"../utils\";\r\nimport {getTileSelectorByName} from \"../generators\";\r\nimport {GlobalActions, IMPORT_PROJECT} from \"../actions\";\r\n\r\nexport interface GeneratorState {\r\n    rows: number;\r\n    cols: number;\r\n    tileSelector: string;\r\n    tileSelectorProperties: any;\r\n    backgroundColorId: number | null;\r\n}\r\n\r\nexport const initialState: GeneratorState = {\r\n    rows: 17,\r\n    cols: 17,\r\n    tileSelector: varToString({LinearSelector}),\r\n    tileSelectorProperties: LinearSelector.defaultProperties,\r\n    backgroundColorId: null,\r\n}\r\n\r\nexport function generator(state: GeneratorState = initialState, action: GeneratorActions | GlobalActions): GeneratorState {\r\n    switch (action.type) {\r\n        case GENERATOR_SET_ROWS:\r\n            return {...state, rows: action.rows};\r\n        case GENERATOR_SET_COLS:\r\n            return {...state, cols: action.cols};\r\n        case GENERATOR_SET_SELECTOR:\r\n            return {...state,\r\n                tileSelector: action.selector,\r\n                tileSelectorProperties: getTileSelectorByName(action.selector).defaultProperties\r\n            };\r\n        case GENERATOR_SET_SELECTOR_PROPERTY:\r\n            return {\r\n                ...state,\r\n                tileSelectorProperties: {\r\n                    ...state.tileSelectorProperties,\r\n                    [action.prop]: action.value\r\n                }\r\n            }\r\n        case IMPORT_PROJECT:\r\n            return JSON.parse(JSON.stringify(action.data.generator));\r\n        case GENERATOR_SET_BACKGROUND:\r\n            return {...state, backgroundColorId: action.backgroundColorId};\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n","import {combineReducers, createStore} from \"redux\";\r\nimport { composeWithDevTools } from \"redux-devtools-extension\";\r\nimport {editor} from \"./editor\";\r\nimport {palette} from \"./palette\";\r\nimport {tiles} from \"./tiles\";\r\nimport {generator} from \"./generator\";\r\n\r\nconst rootReducer = combineReducers({\r\n    editor,\r\n    palette,\r\n    tiles,\r\n    generator\r\n});\r\n\r\nconst store = createStore(rootReducer,\r\n    composeWithDevTools()\r\n);\r\n\r\nexport type TheState = ReturnType<typeof rootReducer>\r\n\r\nexport default store;\r\n","import React, {useCallback, useMemo} from \"react\";\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport bem from \"bem-ts\";\r\nimport Scrollable from \"../../components/Scrollable\";\r\nimport IntegerControl from \"../../components/controls/IntegerControl\";\r\nimport {Provider, useDispatch, useSelector} from \"react-redux\";\r\nimport {setCols, setRows, setSelector, setSelectorProperty} from \"../../actions/generator\";\r\nimport {\r\n    colsSelector,\r\n    rowsSelector,\r\n    tileSelectorKeySelector,\r\n    tileSelectorPropertiesSelector\r\n} from \"../../selectors/generator\";\r\nimport Field from \"../../components/controls/Field\";\r\nimport {MinValidator} from \"../../properties/validators\";\r\nimport SelectControl from \"../../components/controls/SelectControl\";\r\nimport generators, {getTileSelectorByName} from \"../../generators\";\r\nimport PropertyEditor from \"../../components/PropertyEditor\";\r\nimport {getPropertyDefinitions} from \"../../properties/decorators\";\r\nimport {download} from \"../../utils\";\r\nimport GenerateMosaic from \"../../components/GenerateMosaic\";\r\nimport store from \"../../reducers\";\r\n\r\nconst blk = bem('gen-settings');\r\n\r\nconst GeneratorSettings = () => {\r\n    const rows = useSelector(rowsSelector);\r\n    const cols = useSelector(colsSelector);\r\n    const tileSelectorKey = useSelector(tileSelectorKeySelector);\r\n    const tileSelector = getTileSelectorByName(tileSelectorKey);\r\n    const tileSelectorProperties = useSelector(tileSelectorPropertiesSelector);\r\n    const dispatch = useDispatch();\r\n\r\n    const handleRowsChange = useCallback((value: number | null) => {\r\n        dispatch(setRows(value ?? 0));\r\n    }, [dispatch]);\r\n\r\n    const handleColsChange = useCallback((value: number | null) => {\r\n        dispatch(setCols(value ?? 0));\r\n    }, [dispatch]);\r\n\r\n    const handleTileSelectorChange = useCallback(value => {\r\n        dispatch(setSelector(value));\r\n    }, [dispatch]);\r\n\r\n    const selectorChoices = useMemo(() => Object.keys(generators.tileSelectors).map((choice) => ({\r\n        key: choice,\r\n        label: getTileSelectorByName(choice).label\r\n    })), [generators.tileSelectors]);\r\n\r\n    const propertiesValueAccessor = useCallback((name) => {\r\n        return tileSelectorProperties[name];\r\n    }, [tileSelectorProperties]);\r\n\r\n    const handlePropertyChange = useCallback((name, value) => {\r\n        dispatch(setSelectorProperty(name, value));\r\n    }, [dispatch]);\r\n\r\n    const handleExport = useCallback(() => {\r\n        download('mosaic.svg', ReactDOMServer.renderToStaticMarkup(\r\n            <Provider store={store}>\r\n                <GenerateMosaic />\r\n            </Provider>\r\n        ))\r\n    }, []);\r\n\r\n    return (\r\n        <div className={blk()}>\r\n            <Scrollable>\r\n                <div className={blk('content')}>\r\n                    <h1 className=\"title\">Settings</h1>\r\n                    <button onClick={handleExport} className=\"button is-fullwidth is-link mb-3\">Export mosaic</button>\r\n                    <Field<number>\r\n                        control={IntegerControl}\r\n                        label=\"Rows\"\r\n                        onChange={handleRowsChange}\r\n                        validators={[MinValidator(1)]}\r\n                        required\r\n                        value={rows} />\r\n                    <Field<number>\r\n                        control={IntegerControl}\r\n                        label=\"Columns\"\r\n                        onChange={handleColsChange}\r\n                        validators={[MinValidator(1)]}\r\n                        required\r\n                        value={cols} />\r\n\r\n                    <div className=\"field-container\">\r\n                        <Field<string>\r\n                            label=\"Tile selector\"\r\n                            control={SelectControl}\r\n                            onChange={handleTileSelectorChange}\r\n                            value={tileSelectorKey}\r\n                            choices={selectorChoices}\r\n                            required />\r\n                        <p className=\"help\">{tileSelector.description}</p>\r\n                        <PropertyEditor\r\n                            definitions={getPropertyDefinitions(tileSelector.defaultProperties)}\r\n                            valueAccessor={propertiesValueAccessor}\r\n                            onChange={handlePropertyChange} />\r\n                    </div>\r\n                </div>\r\n            </Scrollable>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default GeneratorSettings;\r\n","import {DragDropContext, Draggable, Droppable} from \"react-beautiful-dnd\";\r\nimport SvgCanvas from \"./SvgCanvas\";\r\nimport SvgShapeRenderer from \"./SvgShapeRenderer\";\r\nimport React, {useCallback} from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {tilesSelector} from \"../selectors/tiles\";\r\nimport {setTiles} from \"../actions/tiles\";\r\nimport {reorder} from \"../utils\";\r\n\r\nconst blk = bem('reorder');\r\n\r\nconst ReorderableTileList = () => {\r\n    const tiles = useSelector(tilesSelector);\r\n    const dispatch = useDispatch();\r\n\r\n    const handleDragEnd = useCallback((result) => {\r\n        if (!result.destination) {\r\n            return;\r\n        }\r\n        dispatch(setTiles(reorder(\r\n            tiles,\r\n            result.source.index,\r\n            result.destination.index\r\n        )));\r\n    }, [tiles, dispatch]);\r\n\r\n    return (\r\n        <DragDropContext onDragEnd={handleDragEnd}>\r\n            <div className={blk('columns')}>\r\n                <div className={blk('col', ['idx'])}>\r\n                    {tiles.map((_, idx) => (\r\n                        <div key={idx} className={blk('item', ['idx'])}>{idx}</div>\r\n                    ))}\r\n                </div>\r\n                <Droppable droppableId=\"tiles\">\r\n                    {(provided, snapshot) => (\r\n                        <div\r\n                            {...provided.droppableProps}\r\n                            ref={provided.innerRef}\r\n                            className={blk('col', ['items'])}\r\n                        >\r\n                            {tiles.map((tile, idx) => (\r\n                                <Draggable key={tile.id} draggableId={tile.id.toString()} index={idx}>\r\n                                    {(innerProvided) => (\r\n                                        <div\r\n                                            {...innerProvided.dragHandleProps}\r\n                                            {...innerProvided.draggableProps}\r\n                                            ref={innerProvided.innerRef}\r\n                                            className={blk('item', ['tile'])}\r\n                                        >\r\n                                            <div className={blk('thumb')}>\r\n                                                <SvgCanvas blk={blk}>\r\n                                                    {tile.elements.map(el => <SvgShapeRenderer key={el.id} shape={el} />)}\r\n                                                </SvgCanvas>\r\n                                            </div>\r\n                                            <div className={blk('label')}>\r\n                                                ID: {tile.id}\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </Draggable>\r\n                            ))}\r\n                            {provided.placeholder}\r\n                        </div>\r\n                    )}\r\n                </Droppable>\r\n            </div>\r\n        </DragDropContext>\r\n    )\r\n}\r\n\r\nexport default ReorderableTileList;\r\n","import bem from \"bem-ts\";\r\nimport React, {useCallback} from \"react\";\r\nimport Scrollable from \"../../components/Scrollable\";\r\nimport Field from \"../../components/controls/Field\";\r\nimport PalettePickerControl from \"../../components/controls/PalettePickerControl\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {backgroundColorIdSelector} from \"../../selectors/generator\";\r\nimport {setBackground} from \"../../actions/generator\";\r\nimport ReorderableTileList from \"../../components/ReorderableTileList\";\r\n\r\nconst blk = bem('tiles-sidebar');\r\n\r\nconst TilesSidebar = () => {\r\n    const backgroundColorId = useSelector(backgroundColorIdSelector);\r\n    const dispatch = useDispatch();\r\n\r\n    const handleBackgroundChange = useCallback(id => {\r\n        dispatch(setBackground(id));\r\n    }, [dispatch]);\r\n\r\n    return (\r\n        <div className={blk()}>\r\n            <Scrollable>\r\n                <div className={blk('content')}>\r\n                    <h1 className=\"title\">Tiles</h1>\r\n                    <Field\r\n                        label=\"Background color\"\r\n                        control={PalettePickerControl}\r\n                        onChange={handleBackgroundChange}\r\n                        value={backgroundColorId}\r\n                    />\r\n                    <h2 className=\"title is-4 mt-5\">Tile set</h2>\r\n                    <p className=\"subtitle is-6\">Reorder by drag&drop</p>\r\n                    <ReorderableTileList />\r\n                </div>\r\n            </Scrollable>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default TilesSidebar;\r\n","import React from \"react\";\r\nimport FullscreenPageLayout from \"layouts/FullscreenPageLayout\";\r\nimport Navbar from \"../../components/Navbar\";\r\nimport Footer from \"../../components/Footer\";\r\nimport PanelLayout from \"../../layouts/PanelLayout\";\r\nimport bem from \"bem-ts\";\r\nimport GeneratorSettings from \"./GeneratorSettings\";\r\nimport GenerateMosaic from \"../../components/GenerateMosaic\";\r\nimport TilesSidebar from \"./TilesSidebar\";\r\nimport ErrorBoundary from \"../../components/ErrorBoundary\";\r\n\r\nconst blk = bem('generator');\r\n\r\nconst Generator = () => {\r\n    return (\r\n        <FullscreenPageLayout header={<Navbar />} footer={<Footer />}>\r\n            <PanelLayout horizontal left={<GeneratorSettings />} right={<TilesSidebar />}>\r\n                <div className={blk()}>\r\n                    <div className={blk('wrap')}>\r\n                        <ErrorBoundary>\r\n                            <GenerateMosaic />\r\n                        </ErrorBoundary>\r\n                    </div>\r\n                </div>\r\n            </PanelLayout>\r\n        </FullscreenPageLayout>\r\n    )\r\n}\r\n\r\nexport default Generator;\r\n","import Tile from \"../../models/Tile\";\r\nimport React, {useCallback} from \"react\";\r\nimport bem from \"bem-ts\";\r\nimport SvgCanvas from \"../../components/SvgCanvas\";\r\nimport SvgShapeRenderer from \"../../components/SvgShapeRenderer\";\r\nimport {useDispatch} from \"react-redux\";\r\nimport {deleteTile, duplicateTile, rotate} from \"../../actions/tiles\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport {TileIdGenerator} from \"../../idGenerators\";\r\n\r\nconst blk = bem('tile-item');\r\n\r\nconst TileItem = (props: {tile: Tile, idx: number}) => {\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n\r\n    const handleEdit = useCallback(() => {\r\n        history.push(`/tiles/${props.tile.id}`);\r\n    }, [props.tile, history]);\r\n\r\n    const handleDelete = useCallback(() => {\r\n        dispatch(deleteTile(props.tile.id));\r\n    }, [props.tile, dispatch]);\r\n\r\n    const handleClone = useCallback(() => {\r\n        dispatch(duplicateTile(props.idx, TileIdGenerator.getNextId()));\r\n    }, [props.idx]);\r\n\r\n    const handleRotateCCW = useCallback(() => {\r\n        dispatch(rotate(props.idx, true));\r\n    }, [props.idx, dispatch]);\r\n\r\n    const handleRotateCW = useCallback(() => {\r\n        dispatch(rotate(props.idx, false));\r\n    }, [props.idx, dispatch]);\r\n\r\n    return (\r\n        <div className={blk()}>\r\n            <div className={blk('thumb')}>\r\n                <SvgCanvas blk={blk}>\r\n                    {props.tile.elements.map(el => <SvgShapeRenderer key={el.id} shape={el} />)}\r\n                </SvgCanvas>\r\n                <div className={blk('actions')}>\r\n                    <button onClick={handleClone} className={blk('action')}>\r\n                        <span className=\"icon\">\r\n                            <i className=\"fas fa-clone\" />\r\n                        </span>\r\n                    </button>\r\n                    <button onClick={handleRotateCCW} className={blk('action')}>\r\n                        <span className=\"icon\">\r\n                            <i className=\"fas fa-undo\" />\r\n                        </span>\r\n                    </button>\r\n                    <button onClick={handleRotateCW} className={blk('action')}>\r\n                        <span className=\"icon\">\r\n                            <i className=\"fas fa-redo\" />\r\n                        </span>\r\n                    </button>\r\n                    <button onClick={handleDelete} className={blk('action', ['delete'])}>\r\n                        <span className=\"icon\">\r\n                            <i className=\"fas fa-trash\" />\r\n                        </span>\r\n                    </button>\r\n                    <button onClick={handleEdit} className={blk('action')}>\r\n                        <span className=\"icon\">\r\n                            <i className=\"fas fa-pen\" />\r\n                        </span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <div className={blk('label')}>\r\n                <span className=\"has-text-grey\">idx: {props.idx}</span>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport const NewTileItem = ({onClick}: {onClick: () => void}) => (\r\n    <div onClick={onClick} className={blk(['new'])}>\r\n        <span className=\"icon\"><i className=\"fas fa-plus fa-2x\" /></span>\r\n    </div>\r\n);\r\n\r\nexport default TileItem;\r\n","import FullscreenPageLayout from \"layouts/FullscreenPageLayout\";\r\nimport React, {useCallback} from \"react\";\r\nimport Navbar from \"../../components/Navbar\";\r\nimport Footer from \"../../components/Footer\";\r\nimport bem from \"bem-ts\";\r\nimport {useSelector} from \"react-redux\";\r\nimport {tilesSelector} from \"../../selectors/tiles\";\r\nimport Scrollable from \"../../components/Scrollable\";\r\nimport TileItem, {NewTileItem} from \"./TileItem\";\r\nimport {NavLink, useHistory} from \"react-router-dom\";\r\nimport ErrorBoundary from \"../../components/ErrorBoundary\";\r\n\r\nconst blk = bem('tiles');\r\n\r\n\r\nconst Tiles = () => {\r\n    const tiles = useSelector(tilesSelector);\r\n    const history = useHistory();\r\n\r\n    const handleAddNew = useCallback(() => {\r\n        history.push('/tiles/new');\r\n    }, [history]);\r\n\r\n    return (\r\n        <FullscreenPageLayout header={<Navbar />} footer={<Footer />}>\r\n            <Scrollable>\r\n                <div className={blk()}>\r\n                    <div className={blk('heading')}>\r\n                        <h1 className=\"title\">Tiles</h1>\r\n                        <p className={blk('actions')}>\r\n                            <NavLink to=\"/tiles/reorder\">Reorder</NavLink>\r\n                        </p>\r\n                    </div>\r\n                    <ErrorBoundary>\r\n                        <div className={blk('items')}>\r\n                            {tiles.map((tile, idx) => <TileItem key={tile.id} idx={idx} tile={tile} />)}\r\n                            <NewTileItem onClick={handleAddNew} />\r\n                        </div>\r\n                    </ErrorBoundary>\r\n                </div>\r\n            </Scrollable>\r\n        </FullscreenPageLayout>\r\n    );\r\n}\r\n\r\nexport default Tiles;\r\n","import React from \"react\";\r\nimport FullscreenPageLayout from \"../../layouts/FullscreenPageLayout\";\r\nimport Navbar from \"../../components/Navbar\";\r\nimport Footer from \"../../components/Footer\";\r\nimport bem from \"bem-ts\";\r\nimport Scrollable from \"../../components/Scrollable\";\r\nimport {NavLink} from \"react-router-dom\";\r\nimport ReorderableTileList from \"../../components/ReorderableTileList\";\r\nimport ErrorBoundary from \"../../components/ErrorBoundary\";\r\n\r\nconst blk = bem('reorder');\r\n\r\nconst Reorder = () => {\r\n    return (\r\n        <FullscreenPageLayout header={<Navbar />} footer={<Footer />}>\r\n            <Scrollable>\r\n                <div className={blk()}>\r\n                    <div className={blk('heading')}>\r\n                        <h1 className=\"title\">Reorder tiles</h1>\r\n                        <p className={blk('actions')}>\r\n                            <NavLink to=\"/tiles\">Back</NavLink>\r\n                        </p>\r\n                    </div>\r\n                    <p className=\"subtitle\">Reorder tiles by drag & drop</p>\r\n                    <ErrorBoundary>\r\n                        <ReorderableTileList />\r\n                    </ErrorBoundary>\r\n                </div>\r\n            </Scrollable>\r\n        </FullscreenPageLayout>\r\n    );\r\n}\r\n\r\nexport default Reorder;\r\n","import {Dispatch} from \"redux\";\r\nimport {importProject, ProjectType} from \"./actions\";\r\nimport {PaletteIdGenerator, ShapeIdGenerator, TileIdGenerator} from \"./idGenerators\";\r\n\r\nexport function importProjectAndSetupIdGenerators(dispatch: Dispatch, data: ProjectType) {\r\n    dispatch(importProject(data));\r\n\r\n    const maxPaletteId = Object.keys(data.palette).reduce((max, id) => Math.max(max, parseInt(id, 10)), 0);\r\n    PaletteIdGenerator.setLastId(maxPaletteId);\r\n\r\n    const maxTileId = data.tiles.reduce((max, tile) => Math.max(max, tile.id), 0);\r\n    TileIdGenerator.setLastId(maxTileId);\r\n\r\n    const maxShapeId = data.tiles.reduce((max, tile) => {\r\n        return Math.max(max, tile.elements.reduce((elMax, el) => Math.max(elMax, el.id), 0));\r\n    }, 0);\r\n    ShapeIdGenerator.setLastId(maxShapeId);\r\n}\r\n","import React, {useCallback, useState} from \"react\";\r\nimport FullscreenPageLayout from \"../../layouts/FullscreenPageLayout\";\r\nimport Navbar from \"../../components/Navbar\";\r\nimport Footer from \"../../components/Footer\";\r\nimport bem from \"bem-ts\";\r\nimport {useDispatch} from \"react-redux\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport {importProjectAndSetupIdGenerators} from \"../../import\";\r\n\r\nconst blk = bem('import');\r\n\r\nconst Import = () => {\r\n    const [file, setFile] = useState<any>();\r\n    const [error, setError] = useState<string>();\r\n    const history = useHistory();\r\n    const dispatch = useDispatch();\r\n\r\n    const handleFileChange = useCallback(e => {\r\n        setError(undefined);\r\n        setFile(e.target.files[0]);\r\n    }, [setFile]);\r\n\r\n    const handleImport = useCallback(() => {\r\n        if (!file) {\r\n            setError('First choose a project file.');\r\n            return;\r\n        }\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = event => {\r\n            if (!event.target?.result) {\r\n                setError('Error reading file.');\r\n                return;\r\n            }\r\n            try {\r\n                const data = JSON.parse(event.target.result as string);\r\n                importProjectAndSetupIdGenerators(dispatch, data);\r\n                history.push('/');\r\n            } catch (e: any) {\r\n                setError(e.message);\r\n            }\r\n        }\r\n        reader.readAsText(file);\r\n    }, [file, dispatch, history]);\r\n\r\n    return (\r\n        <FullscreenPageLayout header={<Navbar />} footer={<Footer />}>\r\n            <div className={blk()}>\r\n                <div className=\"card\">\r\n                    <div className=\"card-content\">\r\n                        <div className=\"content\">\r\n                            <h1 className=\"mb-5\">Import project</h1>\r\n                            <hr/>\r\n                            <div className=\"field mb-5\">\r\n                                <div className=\"control\">\r\n                                    <div className=\"file\">\r\n                                        <label className=\"file-label\">\r\n                                            <input className=\"file-input\" type=\"file\" name=\"projectFile\" onChange={handleFileChange} />\r\n                                            <span className=\"file-cta\">\r\n                                              <span className=\"file-icon\">\r\n                                                <i className=\"fas fa-upload\" />\r\n                                              </span>\r\n                                              <span className=\"file-label\">\r\n                                                Choose a file\r\n                                              </span>\r\n                                            </span>\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n                                <p className=\"help\">Choose a JSON file exported from this application.</p>\r\n                                {error && <p className=\"help is-danger\">{error}</p>}\r\n                            </div>\r\n                            <div className=\"field\">\r\n                                <div className=\"control\">\r\n                                    <button className=\"button is-link\" onClick={handleImport}>Import</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </FullscreenPageLayout>\r\n    )\r\n}\r\n\r\nexport default Import;\r\n","import React, {useEffect, useState} from \"react\";\r\nimport FullscreenPageLayout from \"../../layouts/FullscreenPageLayout\";\r\nimport Navbar from \"../../components/Navbar\";\r\nimport Footer from \"../../components/Footer\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport Scrollable from \"../../components/Scrollable\";\r\nimport ErrorBoundary from \"../../components/ErrorBoundary\";\r\n\r\nconst Help = () => {\r\n    const [readme, setReadme] = useState<string>('');\r\n\r\n    useEffect(() => {\r\n        fetch('https://raw.githubusercontent.com/EnkeyMC/TileMosaicGenerator/main/README.md')\r\n            .then(response => {\r\n                if (response.ok) {\r\n                    return response.text();\r\n                } else {\r\n                    throw new Error('Request returned with status ' + response.status + ': ' + response.statusText);\r\n                }\r\n            })\r\n            .then(text => setReadme(text))\r\n            .catch(err => setReadme(`# Error loading readme\\n\\nReason: ${err}`));\r\n    }, []);\r\n\r\n    return (\r\n        <FullscreenPageLayout header={<Navbar />} footer={<Footer />}>\r\n            <Scrollable>\r\n                <div className=\"container pt-6 pb-6\">\r\n                    <ErrorBoundary>\r\n                        <ReactMarkdown className=\"content\">\r\n                            {readme}\r\n                        </ReactMarkdown>\r\n                    </ErrorBoundary>\r\n                </div>\r\n            </Scrollable>\r\n        </FullscreenPageLayout>\r\n    )\r\n}\r\n\r\nexport default Help;\r\n","import React from 'react';\nimport {Switch, Route, HashRouter} from 'react-router-dom';\nimport TileEditor from \"./pages/TileEditor\";\nimport Generator from \"./pages/Generator\";\nimport Tiles from \"./pages/Tiles\";\nimport Reorder from \"./pages/Tiles/Reorder\";\nimport Import from \"./pages/Import\";\nimport Help from \"./pages/Help\";\nimport ErrorBoundary from \"./components/ErrorBoundary\";\n\nfunction App() {\n    return (\n        <HashRouter>\n            <Switch>\n                <Route path=\"/tiles/new\">\n                    <ErrorBoundary>\n                        <TileEditor />\n                    </ErrorBoundary>\n                </Route>\n                <Route path=\"/tiles/reorder\">\n                    <ErrorBoundary>\n                        <Reorder />\n                    </ErrorBoundary>\n                </Route>\n                <Route path=\"/tiles/:id\">\n                    <ErrorBoundary>\n                        <TileEditor />\n                    </ErrorBoundary>\n                </Route>\n                <Route path=\"/tiles\">\n                    <ErrorBoundary>\n                        <Tiles />\n                    </ErrorBoundary>\n                </Route>\n                <Route path=\"/import\">\n                    <ErrorBoundary>\n                        <Import />\n                    </ErrorBoundary>\n                </Route>\n                <Route path=\"/help\">\n                    <ErrorBoundary>\n                        <Help />\n                    </ErrorBoundary>\n                </Route>\n                <Route path=\"/\">\n                    <ErrorBoundary>\n                        <Generator />\n                    </ErrorBoundary>\n                </Route>\n            </Switch>\n        </HashRouter>\n    );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './scss/styles.scss';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport store from \"./reducers\";\r\nimport { Provider } from 'react-redux';\r\n\r\nimport '@fortawesome/fontawesome-free/js/fontawesome'\r\nimport '@fortawesome/fontawesome-free/js/solid'\r\nimport '@fortawesome/fontawesome-free/js/regular'\r\nimport '@fortawesome/fontawesome-free/js/brands'\r\nimport {exportSelector} from \"./selectors\";\r\nimport {importProjectAndSetupIdGenerators} from \"./import\";\r\nimport exampleProject from \"./exampleProject\";\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n      <Provider store={store}>\r\n          <App />\r\n      </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nconst savedState = localStorage.getItem('state');\r\nif (savedState) {\r\n    importProjectAndSetupIdGenerators(store.dispatch, JSON.parse(savedState as any));\r\n} else {\r\n    importProjectAndSetupIdGenerators(store.dispatch, JSON.parse(exampleProject));\r\n}\r\n\r\nwindow.onbeforeunload = () => {\r\n    const data = JSON.stringify(exportSelector(store.getState()));\r\n    localStorage.setItem('state', data);\r\n}\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","export default '{\"version\":{\"MAJOR\":0,\"MINOR\":1},\"tiles\":[{\"id\":10,\"elements\":[{\"type\":\"POLYGON\",\"zIndex\":0,\"fillColorId\":0,\"points\":[{\"x\":0,\"y\":0},{\"x\":100,\"y\":100},{\"x\":100,\"y\":100},{\"x\":0,\"y\":100},{\"x\":0,\"y\":100}],\"strokeColorId\":null,\"strokeWidth\":null,\"id\":9}]},{\"id\":12,\"elements\":[{\"type\":\"POLYGON\",\"zIndex\":0,\"fillColorId\":0,\"points\":[{\"x\":100,\"y\":100},{\"x\":0,\"y\":0},{\"x\":0,\"y\":0},{\"x\":100,\"y\":0},{\"x\":100,\"y\":0}],\"strokeColorId\":null,\"strokeWidth\":null,\"id\":9}]},{\"id\":11,\"elements\":[{\"type\":\"POLYGON\",\"zIndex\":0,\"fillColorId\":0,\"points\":[{\"x\":100,\"y\":0},{\"x\":0,\"y\":100},{\"x\":0,\"y\":100},{\"x\":0,\"y\":0},{\"x\":0,\"y\":0}],\"strokeColorId\":null,\"strokeWidth\":null,\"id\":9}]},{\"id\":13,\"elements\":[{\"type\":\"POLYGON\",\"zIndex\":0,\"fillColorId\":0,\"points\":[{\"x\":0,\"y\":100},{\"x\":100,\"y\":0},{\"x\":100,\"y\":0},{\"x\":100,\"y\":100},{\"x\":100,\"y\":100}],\"strokeColorId\":null,\"strokeWidth\":null,\"id\":9}]},{\"id\":14,\"elements\":[]},{\"id\":15,\"elements\":[{\"type\":\"POLYGON\",\"zIndex\":0,\"fillColorId\":0,\"points\":[{\"x\":0,\"y\":0},{\"x\":100,\"y\":0},{\"x\":100,\"y\":0},{\"x\":100,\"y\":100},{\"x\":100,\"y\":100},{\"x\":0,\"y\":100},{\"x\":0,\"y\":100}],\"strokeColorId\":null,\"strokeWidth\":null,\"id\":10}]}],\"generator\":{\"rows\":18,\"cols\":21,\"tileSelector\":\"LinearSelector\",\"tileSelectorProperties\":{\"step\":1,\"offset\":0}},\"palette\":{\"0\":\"#000\"}}';\r\n"],"sourceRoot":""}